<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Primary Meta Tags -->
  <title>Swim Meet Score - Free Swimming Scoresheet & Scoring Tool | SwimMeet Tracker</title>
  <meta name="title" content="Swim Meet Score - Free Swimming Scoresheet & Scoring Tool | SwimMeet Tracker">
  <meta name="description" content="Free swim meet scoring tool and printable swimming scoresheet. Track team scores, individual events, relays, and diving. High school swim meet scoring sheet, dual meet scoresheet, diving score sheet. No download required!">
  <meta name="keywords" content="swim meet score, swimmeet, swimming scoresheet, swim meet score sheet, print swim meet, printable scoring sheet, diving score sheet, swimming scoresheet, dual meet scoresheet, high school swim meet scoring sheet, high school combined meet, swim meet tracker, swimming scoreboard, team swimming scores, swim meet management, diving scores, relay scoring, high school swim meet, varsity swimming, JV swim meet, swim and dive scoring">
  <meta name="author" content="Kaden Co">
  <meta name="robots" content="index, follow">
  <meta name="language" content="English">
  <meta name="revisit-after" content="7 days">
  
  <!-- Canonical URL -->
  <link rel="canonical" href="https://swimmeetscore.com/">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://swimmeetscore.com/">
  <meta property="og:title" content="Swim Meet Score - Free Swimming Scoresheet & Scoring Tool">
  <meta property="og:description" content="Free swim meet scoring tool and printable swimming scoresheet. Track team scores for high school dual meets, championship meets, diving, and relays. No app download required!">
  <meta property="og:image" content="https://swimmeetscore.com/og-image.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:site_name" content="Swim Meet Score">
  <meta property="og:locale" content="en_US">
  
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="https://swimmeetscore.com/">
  <meta name="twitter:title" content="Swim Meet Score - Free Swimming Scoresheet & Scoring Tool">
  <meta name="twitter:description" content="Free swim meet scoring tool and printable swimming scoresheet. Track team scores for high school dual meets, championship meets, diving, and relays. No app download required!">
  <meta name="twitter:image" content="https://swimmeetscore.com/og-image.png">
  
  <!-- PWA / Mobile -->
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#0f2942">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Swim Meet Score">
  
  <!-- Verification -->
  <meta name="google-site-verification" content="E6jMP8Bm02-2gUIhCyzFM6nRLixGSuCHrVdv4qh13ks" />
  
  <!-- Microsoft Bing SEO -->
  <!-- Bing verification: Site imported from Google Search Console (no separate verification needed) -->
  
  <!-- Additional Bing/Microsoft SEO Meta Tags -->
  <meta name="msnbot" content="index, follow">
  <meta name="bingbot" content="index, follow">
  <meta name="geo.region" content="US">
  <meta name="geo.placename" content="United States">
  <meta name="rating" content="general">
  <meta name="distribution" content="global">
  <meta name="coverage" content="Worldwide">
  <meta name="target" content="all">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  
  <!-- Additional SEO - Helps all search engines -->
  <meta name="subject" content="Swim Meet Scoring Application">
  <meta name="topic" content="Swimming, Sports Scoring, Swim Meet Management">
  <meta name="summary" content="Free online swim meet scoring tool for tracking team scores, individual events, relays, and diving at high school and competitive swim meets.">
  <meta name="classification" content="Sports/Swimming">
  <meta name="designer" content="Kaden Co">
  <meta name="owner" content="Kaden Co">
  <meta name="url" content="https://swimmeetscore.com">
  <meta name="identifier-URL" content="https://swimmeetscore.com">
  <meta name="pagename" content="Swim Meet Score - Free Swimming Scoresheet">
  <meta name="category" content="Sports, Swimming, Scoring Tools">
  
  <!-- Link to sitemap for search engines -->
  <link rel="sitemap" type="application/xml" title="Sitemap" href="./sitemap.xml">
  
  <!-- Google Analytics 4 with Offline Support -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-0G72MC7J4M"></script>
  
  <!-- Clarity tracking code for https://swimmeetscore.com/ -->
  <script>
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i+"?ref=bwt";
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "v3wvpal09e");
  </script>
  
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-0G72MC7J4M');
    
    // Offline analytics queue
    const ANALYTICS_QUEUE_KEY = 'swimmeetscore_analytics_queue';
    
    // Get queued events from localStorage
    function getAnalyticsQueue() {
      try {
        const queue = localStorage.getItem(ANALYTICS_QUEUE_KEY);
        return queue ? JSON.parse(queue) : [];
      } catch (e) {
        return [];
      }
    }
    
    // Save event to queue
    function queueAnalyticsEvent(eventName, eventParams) {
      try {
        const queue = getAnalyticsQueue();
        queue.push({
          name: eventName,
          params: eventParams,
          timestamp: new Date().toISOString()
        });
        localStorage.setItem(ANALYTICS_QUEUE_KEY, JSON.stringify(queue));
      } catch (e) {
        console.log('Failed to queue analytics event');
      }
    }
    
    // Send all queued events
    function flushAnalyticsQueue() {
      const queue = getAnalyticsQueue();
      if (queue.length === 0) return;
      
      console.log('SwimMeetScore: Sending ' + queue.length + ' queued analytics events');
      
      queue.forEach((event) => {
        if (typeof gtag !== 'undefined') {
          // Add queued flag and original timestamp
          const params = { ...event.params, queued: true, queued_at: event.timestamp };
          gtag('event', event.name, params);
        }
      });
      
      // Clear the queue
      localStorage.removeItem(ANALYTICS_QUEUE_KEY);
    }
    
    // Custom event tracking function with offline support
    function trackEvent(eventName, eventParams = {}) {
      if (navigator.onLine && typeof gtag !== 'undefined') {
        // Online - send immediately
        gtag('event', eventName, eventParams);
      } else {
        // Offline - queue for later
        queueAnalyticsEvent(eventName, eventParams);
      }
    }
    
    // Send queued events when coming back online
    window.addEventListener('online', () => {
      console.log('SwimMeetScore: Back online, flushing analytics queue');
      // Small delay to ensure connection is stable
      setTimeout(flushAnalyticsQueue, 2000);
    });
    
    // Also try to flush queue on page load (in case they went offline then closed app)
    window.addEventListener('load', () => {
      if (navigator.onLine) {
        setTimeout(flushAnalyticsQueue, 3000);
      }
    });
  </script>
  
  <!-- Structured Data (JSON-LD) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Swim Meet Score",
    "alternateName": ["SwimMeet Score", "Swimming Scoresheet", "Swim Meet Scoring Sheet"],
    "description": "Free online swim meet scoring application and swimming scoresheet. Track team scores, individual events, relays, and diving competitions. Perfect for high school dual meets, championship meets, and varsity swimming.",
    "url": "https://swimmeetscore.com",
    "applicationCategory": "SportsApplication",
    "operatingSystem": "Web Browser",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "author": {
      "@type": "Person",
      "name": "Kaden Co"
    },
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "4.8",
      "ratingCount": "50"
    },
    "featureList": [
      "Team score tracking",
      "Individual event scoring",
      "Relay event scoring", 
      "Diving score sheet",
      "High school swim meet scoring sheet",
      "Dual meet scoresheet",
      "Championship meet scoring",
      "Combined meet scoring",
      "Printable scoring sheet",
      "Customizable point systems",
      "Real-time score updates",
      "Works offline at pools",
      "Dark mode support",
      "Mobile responsive design"
    ],
    "keywords": "swim meet score, swimmeet, swimming scoresheet, dual meet scoresheet, diving score sheet, high school swim meet, printable scoring sheet"
  }
  </script>
  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "Swim Meet Score",
    "alternateName": "SwimMeet Scoresheet",
    "description": "Professional swim meet scoring tool and swimming scoresheet for tracking team and individual event scores during high school dual meets, championship meets, and competitive swimming events.",
    "applicationCategory": "SportsApplication",
    "operatingSystem": "Any",
    "browserRequirements": "Requires JavaScript. Requires HTML5.",
    "softwareVersion": "1.0",
    "datePublished": "2026-01-01",
    "author": {
      "@type": "Organization",
      "name": "Kaden Co"
    }
  }
  </script>
  
  <!-- Organization Schema for Bing -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Kaden Co",
    "url": "https://swimmeetscore.com",
    "logo": "https://swimmeetscore.com/favicon512x512.png",
    "contactPoint": [{
      "@type": "ContactPoint",
      "email": "support@swimmeetscore.com",
      "contactType": "customer support",
      "availableLanguage": "English"
    }],
    "sameAs": []
  }
  </script>
  
  <!-- BreadcrumbList Schema -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [{
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://swimmeetscore.com/"
    }]
  }
  </script>
  
  <!-- FAQPage Schema for common questions (helps with rich snippets) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [{
      "@type": "Question",
      "name": "What is Swim Meet Score?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Swim Meet Score is a free online swim meet scoring tool and swimming scoresheet. It helps coaches, parents, and officials track team scores, individual events, relays, and diving at high school and competitive swim meets."
      }
    }, {
      "@type": "Question",
      "name": "Does Swim Meet Score work offline?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Yes! Once loaded, Swim Meet Score works completely offline - perfect for pools with poor cell service. Your data is saved locally in your browser."
      }
    }, {
      "@type": "Question",
      "name": "Is Swim Meet Score free to use?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Yes, Swim Meet Score is completely free and ad-free. No download or registration required."
      }
    }, {
      "@type": "Question",
      "name": "What scoring formats does Swim Meet Score support?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Swim Meet Score supports high school dual meets (5 places), championship meets (top 8 or top 16), and fully customizable point systems. It handles individual events, relays, and diving with proper tie-breaking rules."
      }
    }]
  }
  </script>
  <!-- Favicons -->
<link rel="icon" type="image/x-icon" href="./favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="./favicon32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="./favicon16x16.png">
<link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png">

  
  <!-- Preconnect to CDNs for faster loading -->
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
  <link rel="dns-prefetch" href="https://cdn.tailwindcss.com">
  
  <!-- Custom Font: Outfit - geometric, modern, sporty -->
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  
  <!-- Critical CSS for loading screen and custom properties -->
  <style>
    :root {
      /* Pool water palette */
      --pool-deep: #0c1929;
      --pool-mid: #0f2942;
      --pool-light: #164e6e;
      --chlorine: #00d4aa;
      --chlorine-glow: #00ffcc;
      --lane-gold: #fbbf24;
      --lane-gold-bright: #fcd34d;
      --foam-white: #e0f7fa;
      --tile-blue: #38bdf8;
      
      /* Light mode palette */
      --sky-pool: #e0f2fe;
      --shallow-water: #7dd3fc;
      --deep-end: #0369a1;
      --sunlit-gold: #f59e0b;
    }
    
    .loading-screen {
      position: fixed;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(180deg, var(--pool-deep) 0%, var(--pool-mid) 50%, var(--pool-light) 100%);
      color: white;
      font-family: 'Outfit', system-ui, sans-serif;
      z-index: 9999;
      overflow: hidden;
    }
    
    /* Animated pool lane lines */
    .loading-screen::before {
      content: '';
      position: absolute;
      inset: 0;
      background: repeating-linear-gradient(
        90deg,
        transparent 0px,
        transparent 60px,
        rgba(251, 191, 36, 0.1) 60px,
        rgba(251, 191, 36, 0.1) 64px
      );
      animation: lanes-drift 3s linear infinite;
    }
    
    @keyframes lanes-drift {
      0% { transform: translateX(0); }
      100% { transform: translateX(64px); }
    }
    
    /* Water ripple effect */
    .loading-screen::after {
      content: '';
      position: absolute;
      width: 200%;
      height: 200%;
      top: -50%;
      left: -50%;
      background: radial-gradient(ellipse at center, transparent 0%, transparent 50%, rgba(0, 212, 170, 0.03) 50%, transparent 70%);
      animation: ripple 4s ease-in-out infinite;
    }
    
    @keyframes ripple {
      0%, 100% { transform: scale(0.8); opacity: 0; }
      50% { transform: scale(1.2); opacity: 1; }
    }
    
    .loading-spinner {
      width: 56px;
      height: 56px;
      border: 3px solid rgba(0, 212, 170, 0.2);
      border-top-color: var(--chlorine);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      position: relative;
      z-index: 1;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .loading-text {
      margin-top: 20px;
      font-size: 20px;
      font-weight: 500;
      color: var(--chlorine);
      letter-spacing: 0.5px;
      position: relative;
      z-index: 1;
    }
    
    /* Swimming wave animation for loading */
    .wave-loader {
      display: flex;
      gap: 4px;
      margin-top: 16px;
      position: relative;
      z-index: 1;
    }
    
    .wave-loader span {
      width: 6px;
      height: 6px;
      background: var(--chlorine);
      border-radius: 50%;
      animation: wave 1.2s ease-in-out infinite;
    }
    
    .wave-loader span:nth-child(2) { animation-delay: 0.1s; }
    .wave-loader span:nth-child(3) { animation-delay: 0.2s; }
    .wave-loader span:nth-child(4) { animation-delay: 0.3s; }
    .wave-loader span:nth-child(5) { animation-delay: 0.4s; }
    
    @keyframes wave {
      0%, 100% { transform: translateY(0); opacity: 0.5; }
      50% { transform: translateY(-10px); opacity: 1; }
    }
    
    /* Entrance animations */
    @keyframes fadeSlideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .animate-fade-slide-up {
      animation: fadeSlideUp 0.5s ease-out forwards;
    }
    
    .animate-fade-in {
      animation: fadeIn 0.4s ease-out forwards;
    }
    
    /* Staggered animation delays */
    .delay-100 { animation-delay: 0.1s; opacity: 0; }
    .delay-200 { animation-delay: 0.2s; opacity: 0; }
    .delay-300 { animation-delay: 0.3s; opacity: 0; }
    
    /* Gold shimmer for 1st place */
    @keyframes goldShimmer {
      0% { background-position: -200% center; }
      100% { background-position: 200% center; }
    }
    
    .gold-shimmer {
      background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(251, 191, 36, 0.1) 50%, 
        transparent 100%
      );
      background-size: 200% 100%;
      animation: goldShimmer 3s ease-in-out infinite;
    }
  </style>
  
  <!-- Load scripts with defer for non-blocking -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            'outfit': ['Outfit', 'system-ui', 'sans-serif'],
          },
          colors: {
            'pool': {
              'deep': '#0c1929',
              'mid': '#0f2942',
              'light': '#164e6e',
            },
            'chlorine': {
              DEFAULT: '#00d4aa',
              'glow': '#00ffcc',
              'dim': '#00a88a',
            },
            'lane': {
              'gold': '#fbbf24',
              'bright': '#fcd34d',
            },
            'foam': '#e0f7fa',
            'tile': '#38bdf8',
          }
        }
      }
    }
  </script>
  <style>
    body { 
      margin: 0; 
      font-family: 'Outfit', system-ui, -apple-system, sans-serif;
    }
    
    /* Hide native number input spinners */
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    input[type="number"] {
      -moz-appearance: textfield;
    }
    
    /* Touch-friendly button styles */
    .touch-btn {
      min-width: 44px;
      min-height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      -webkit-user-select: none;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    
    /* Prevent zoom on input focus for iOS */
    @media screen and (max-width: 768px) {
      input, select, textarea {
        font-size: 16px !important;
      }
    }
    
    /* Improve tap targets on mobile */
    @media (hover: none) and (pointer: coarse) {
      button, select, .touch-btn {
        min-height: 44px;
      }
    }
  </style>
</head>
<body>
  <!-- Loading screen shown while app initializes -->
  <div id="loading-screen" class="loading-screen">
    <div class="loading-spinner"></div>
    <div class="loading-text">Swim Meet Score</div>
    <div class="wave-loader">
      <span></span><span></span><span></span><span></span><span></span>
    </div>
  </div>
  
  <div id="root"></div>
  <script type="text/babel">
    // Hide loading screen once React renders
    const hideLoadingScreen = () => {
      const loadingScreen = document.getElementById('loading-screen');
      if (loadingScreen) {
        loadingScreen.style.opacity = '0';
        loadingScreen.style.transition = 'opacity 0.3s ease-out';
        setTimeout(() => loadingScreen.remove(), 300);
      }
    };

    const { useState, useEffect, useCallback, useMemo, useRef } = React;

    // Utility functions for production robustness
    const utils = {
      // Safe localStorage operations with error handling
      saveToStorage: (key, value) => {
        try {
          const storageKey = 'swimMeetScore_' + key;
          const serialized = JSON.stringify(value);
          localStorage.setItem(storageKey, serialized);
          return true;
        } catch (e) {
          if (e.name === 'QuotaExceededError') {
            console.error('Storage quota exceeded. Some data may not be saved.');
            return false;
          }
          // Private browsing mode or other errors
          return false;
        }
      },

      loadFromStorage: (key, defaultValue) => {
        try {
          const saved = localStorage.getItem('swimMeetScore_' + key);
          if (!saved) return defaultValue;
          const parsed = JSON.parse(saved);
          // Validate parsed data structure
          return parsed !== null && typeof parsed !== 'undefined' ? parsed : defaultValue;
        } catch (e) {
          console.error('Error loading from storage:', e);
          return defaultValue;
        }
      },

      // Generate unique IDs (better than Date.now() for collisions)
      generateId: () => {
        return Date.now().toString(36) + Math.random().toString(36).substr(2);
      },

      // Input validation
      validateTeamName: (name) => {
        const trimmed = (name || '').trim();
        if (trimmed.length === 0) return { valid: false, error: 'Team name cannot be empty' };
        if (trimmed.length > 50) return { valid: false, error: 'Team name must be 50 characters or less' };
        // Prevent XSS - basic sanitization
        if (/<[^>]*>/g.test(trimmed)) return { valid: false, error: 'Team name contains invalid characters' };
        return { valid: true, value: trimmed };
      },

      validateEventName: (name, type) => {
        if (type === 'diving') return { valid: true, value: 'Diving' };
        const trimmed = (name || '').trim();
        if (trimmed.length === 0) return { valid: false, error: 'Event name cannot be empty' };
        if (trimmed.length > 100) return { valid: false, error: 'Event name must be 100 characters or less' };
        if (/<[^>]*>/g.test(trimmed)) return { valid: false, error: 'Event name contains invalid characters' };
        return { valid: true, value: trimmed };
      },

      validateTemplateName: (name) => {
        const trimmed = (name || '').trim();
        if (trimmed.length === 0) return { valid: false, error: 'Template name cannot be empty' };
        if (trimmed.length > 50) return { valid: false, error: 'Template name must be 50 characters or less' };
        return { valid: true, value: trimmed };
      },

      validateNumber: (value, min, max, defaultValue) => {
        const num = parseInt(value, 10);
        if (isNaN(num)) return defaultValue;
        return Math.max(min, Math.min(max, num));
      },

      // Debounce function for localStorage writes
      debounce: (func, wait) => {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      }
    };

    // Icon components
    const Plus = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
      </svg>
    );

    const X = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
      </svg>
    );

    const Settings = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
      </svg>
    );

    const HelpCircle = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="10" strokeWidth={2} />
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3" />
        <circle cx="12" cy="17" r="0.5" fill="currentColor" stroke="none" />
      </svg>
    );

    const Share = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
      </svg>
    );

    const Mail = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
      </svg>
    );

    const Swimmer = ({ className }) => (
       <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <circle cx="19" cy="6" r="2.5" strokeWidth={2} />
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 18c1.2 0 2-.8 3-1.5s1.8-1.5 3-1.5 2 .8 3 1.5 1.8 1.5 3 1.5 2-.8 3-1.5 1.8-1.5 3-1.5" />
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 22c1.2 0 2-.8 3-1.5s1.8-1.5 3-1.5 2 .8 3 1.5 1.8 1.5 3 1.5 2-.8 3-1.5 1.8-1.5 3-1.5" />
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16.5 7.5L12 10l-4.5 2.5" />
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 14.5l2-1.5" />
      </svg>
    );

    const Trophy = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
      </svg>
    );

    const Edit2 = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
      </svg>
    );

    const QrCode = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 3h6v6H3V3zm12 0h6v6h-6V3zM3 15h6v6H3v-6zm12 3h3m-3 3h3m-6-6h6v3h-3m0 3h3M6 6h0m0 12h0m12-12h0" />
      </svg>
    );

    const Zap = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" />
      </svg>
    );

    const Check = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
      </svg>
    );

    const Printer = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
      </svg>
    );

    const ChevronUp = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 15l7-7 7 7" />
      </svg>
    );

    const ChevronDown = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
      </svg>
    );

    const Minus = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20 12H4" />
      </svg>
    );

    // Mobile-friendly number input with +/- buttons
    const NumberInput = ({ value, onChange, min = 1, max = 20, darkMode, className = "", label = "" }) => {
      const handleDecrement = () => {
        const newValue = Math.max(min, (parseInt(value, 10) || min) - 1);
        onChange(newValue);
      };

      const handleIncrement = () => {
        const newValue = Math.min(max, (parseInt(value, 10) || min) + 1);
        onChange(newValue);
      };

      const handleInputChange = (e) => {
        const inputValue = e.target.value;
        if (inputValue === '') {
          onChange(min);
          return;
        }
        const num = parseInt(inputValue, 10);
        if (!isNaN(num)) {
          onChange(Math.max(min, Math.min(max, num)));
        }
      };

      return (
        <div className={`flex items-center ${className}`}>
          <button
            type="button"
            onClick={handleDecrement}
            className={`touch-btn rounded-l-lg border border-r-0 font-bold text-xl transition-colors ${
              darkMode 
                ? 'bg-gray-600 border-gray-500 text-white hover:bg-gray-500 active:bg-gray-400' 
                : 'bg-gray-100 border-gray-300 text-gray-700 hover:bg-gray-200 active:bg-gray-300'
            }`}
            aria-label={`Decrease ${label}`}
          >
            <Minus className="w-5 h-5" />
          </button>
          <input
            type="number"
            inputMode="numeric"
            pattern="[0-9]*"
            min={min}
            max={max}
            value={value}
            onChange={handleInputChange}
            className={`w-16 px-2 py-2 border-t border-b text-center font-medium ${
              darkMode 
                ? 'bg-gray-700 border-gray-500 text-white' 
                : 'bg-white border-gray-300 text-gray-800'
            }`}
            style={{ minHeight: '44px' }}
            aria-label={label}
          />
          <button
            type="button"
            onClick={handleIncrement}
            className={`touch-btn rounded-r-lg border border-l-0 font-bold text-xl transition-colors ${
              darkMode 
                ? 'bg-gray-600 border-gray-500 text-white hover:bg-gray-500 active:bg-gray-400' 
                : 'bg-gray-100 border-gray-300 text-gray-700 hover:bg-gray-200 active:bg-gray-300'
            }`}
            aria-label={`Increase ${label}`}
          >
            <Plus className="w-5 h-5" />
          </button>
        </div>
      );
    };

    // Mobile-friendly point input for scoring systems
    const PointInput = ({ value, onChange, onBlur, place, darkMode }) => {
      const handleDecrement = () => {
        const newValue = Math.max(-999, (parseInt(value, 10) || 0) - 1);
        onChange(newValue);
      };

      const handleIncrement = () => {
        const newValue = Math.min(999, (parseInt(value, 10) || 0) + 1);
        onChange(newValue);
      };

      const handleInputChange = (e) => {
        const inputValue = e.target.value;
        if (inputValue === '' || inputValue === '-') {
          onChange(0);
          return;
        }
        const num = parseInt(inputValue, 10);
        if (!isNaN(num)) {
          onChange(Math.max(-999, Math.min(999, num)));
        }
      };

      const placeLabel = place === 1 ? '1st' : place === 2 ? '2nd' : place === 3 ? '3rd' : `${place}th`;

      return (
        <div className={`p-2 sm:p-3 rounded-lg ${darkMode ? 'bg-gray-600' : 'bg-white'}`}>
          <label className={`text-xs sm:text-sm font-medium block mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>
            {placeLabel}
          </label>
          <div className="flex items-center">
            <button
              type="button"
              onClick={() => { handleDecrement(); onBlur && onBlur(); }}
              className={`touch-btn rounded-l border border-r-0 text-lg font-bold transition-colors ${
                darkMode 
                  ? 'bg-gray-700 border-gray-500 text-white hover:bg-gray-600 active:bg-gray-500' 
                  : 'bg-gray-100 border-gray-300 text-gray-700 hover:bg-gray-200 active:bg-gray-300'
              }`}
              style={{ minWidth: '36px', minHeight: '36px' }}
              aria-label={`Decrease ${placeLabel} points`}
            >
              <Minus className="w-4 h-4" />
            </button>
            <input
              type="number"
              inputMode="numeric"
              pattern="-?[0-9]*"
              value={value}
              onChange={handleInputChange}
              onBlur={onBlur}
              onKeyDown={(e) => {
                if (e.key === 'Enter') {
                  e.target.blur();
                }
              }}
              className={`w-12 px-1 py-1 border-t border-b text-center text-sm font-medium ${
                darkMode 
                  ? 'bg-gray-800 border-gray-500 text-white' 
                  : 'bg-white border-gray-300 text-gray-800'
              }`}
              style={{ minHeight: '36px' }}
              aria-label={`${placeLabel} place points`}
            />
            <button
              type="button"
              onClick={() => { handleIncrement(); onBlur && onBlur(); }}
              className={`touch-btn rounded-r border border-l-0 text-lg font-bold transition-colors ${
                darkMode 
                  ? 'bg-gray-700 border-gray-500 text-white hover:bg-gray-600 active:bg-gray-500' 
                  : 'bg-gray-100 border-gray-300 text-gray-700 hover:bg-gray-200 active:bg-gray-300'
              }`}
              style={{ minWidth: '36px', minHeight: '36px' }}
              aria-label={`Increase ${placeLabel} points`}
            >
              <Plus className="w-4 h-4" />
            </button>
          </div>
        </div>
      );
    };

    // Place selector with dropdown multiselect for ties
    const PlaceSelector = ({ event, place, teams, darkMode, pointSystem, numPlaces, onUpdate, consumedByTie, onToggleDQ }) => {
      const [isOpen, setIsOpen] = useState(false);
      const dropdownRef = useRef(null);

      const result = event.results.find(r => r.place === place);
      const selectedTeamIds = result?.teamIds || [];
      const disqualifiedTeamIds = result?.disqualified || [];
      const placeLabel = place === 1 ? '1st' : place === 2 ? '2nd' : place === 3 ? '3rd' : `${place}th`;

      // Check if a team is DQ'd at this place
      const isTeamDQ = (teamId) => disqualifiedTeamIds.includes(String(teamId));
      
      // Calculate points display - if there's a tie, show split points
      const numTied = selectedTeamIds.length;
      let pointsDisplay = pointSystem[place] ?? 0;
      let splitPointsDisplay = null;
      
      if (numTied > 1) {
        // Sum points for tied places
        let totalPoints = 0;
        for (let i = 0; i < numTied && (place + i) <= numPlaces; i++) {
          totalPoints += (pointSystem[place + i]) || 0;
        }
        splitPointsDisplay = (totalPoints / numTied).toFixed(1).replace(/\.0$/, '');
      }

      const handleTeamToggle = (teamId, isChecked) => {
        onUpdate(event.id, place, teamId, isChecked);
      };

      // Close dropdown when clicking outside
      useEffect(() => {
        const handleClickOutside = (event) => {
          if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {
            setIsOpen(false);
          }
        };
        document.addEventListener('mousedown', handleClickOutside);
        return () => document.removeEventListener('mousedown', handleClickOutside);
      }, []);

      // Get display text for selected teams
      const getDisplayText = () => {
        if (selectedTeamIds.length === 0) return '-';
        const eligibleTeams = selectedTeamIds.filter(id => !disqualifiedTeamIds.includes(String(id)));
        const dqCount = disqualifiedTeamIds.length;

        if (selectedTeamIds.length === 1) {
          const team = teams.find(t => String(t.id) === selectedTeamIds[0]);
          const isDQ = isTeamDQ(selectedTeamIds[0]);
          return team ? (isDQ ? `${team.name} (DQ)` : team.name) : '-';
        }

        if (dqCount > 0 && eligibleTeams.length === 0) {
          return `All DQ (${dqCount})`;
        } else if (dqCount > 0) {
          return `Tie (${eligibleTeams.length}) +${dqCount} DQ`;
        }
        return `Tie (${selectedTeamIds.length})`;
      };

      // If this place is consumed by a previous tie, show it as disabled
      if (consumedByTie) {
        return (
          <div className={`p-1 rounded opacity-50 ${darkMode ? 'bg-gray-800' : 'bg-gray-200'}`}>
            <label className={`text-xs font-medium block ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>
              {placeLabel}
            </label>
            <div className={`w-full px-1 py-1 border rounded text-xs italic ${darkMode ? 'bg-gray-700 border-gray-600 text-gray-500' : 'bg-gray-100 border-gray-300 text-gray-400'}`}>
              (tied above)
            </div>
          </div>
        );
      }

      return (
        <div className={`p-1 rounded ${darkMode ? 'bg-gray-600' : 'bg-white'} ${numTied > 1 ? (darkMode ? 'ring-2 ring-yellow-500' : 'ring-2 ring-yellow-400') : ''}`} ref={dropdownRef}>
          <label className={`text-xs font-medium block ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>
            {placeLabel}
            <span className={`ml-0.5 ${numTied > 1 ? (darkMode ? 'text-yellow-400' : 'text-yellow-600') : ''}`}>
              ({numTied > 1 ? `${splitPointsDisplay} ea` : `${pointsDisplay} pts`})
            </span>
          </label>
          
          {/* Dropdown button */}
          <div className="relative">
            <button
              type="button"
              onClick={() => setIsOpen(!isOpen)}
              className={`w-full px-1 py-1 border rounded text-xs text-left flex items-center justify-between gap-0.5 ${
                darkMode 
                  ? 'bg-gray-700 border-gray-500 text-white hover:bg-gray-650' 
                  : 'bg-white border-gray-300 text-gray-800 hover:bg-gray-50'
              } ${numTied > 1 ? (darkMode ? 'border-yellow-500' : 'border-yellow-400') : ''}`}
              style={{ minHeight: '28px' }}
            >
              <span className={`truncate text-xs ${selectedTeamIds.length === 0 ? (darkMode ? 'text-gray-400' : 'text-gray-500') : ''}`}>
                {getDisplayText()}
              </span>
              <ChevronDown className={`w-3 h-3 flex-shrink-0 transition-transform ${isOpen ? 'rotate-180' : ''}`} />
            </button>
            
            {/* Dropdown menu */}
            {isOpen && (
              <div className={`absolute z-50 mt-1 w-full min-w-[140px] rounded-lg shadow-lg border ${
                darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-200'
              }`} style={{ maxHeight: '400px', overflowY: 'auto' }}>
                {teams.map(team => {
                  const isChecked = selectedTeamIds.includes(String(team.id));
                  const isDQ = isTeamDQ(team.id);
                  return (
                    <div
                      key={team.id}
                      className={`flex items-center gap-2 px-3 py-2 transition-colors ${
                        isDQ
                          ? (darkMode ? 'bg-red-900/50' : 'bg-red-100')
                          : isChecked
                            ? (darkMode ? 'bg-cyan-700' : 'bg-blue-100')
                            : (darkMode ? 'hover:bg-gray-600' : 'hover:bg-gray-100')
                      }`}
                    >
                      <label className="flex items-center gap-2 flex-1 cursor-pointer">
                        <input
                          type="checkbox"
                          checked={isChecked}
                          onChange={(e) => handleTeamToggle(team.id, e.target.checked)}
                          className="w-4 h-4 rounded flex-shrink-0"
                        />
                        <span className={`text-sm ${isDQ ? 'line-through text-red-500' : (darkMode ? 'text-white' : 'text-gray-800')}`}>
                          {team.name}
                          {isDQ && ' (DQ)'}
                        </span>
                      </label>
                      {isChecked && onToggleDQ && (
                        <button
                          onClick={(e) => {
                            e.stopPropagation();
                            onToggleDQ(event.id, place, team.id);
                          }}
                          className={`px-2 py-0.5 rounded text-xs font-bold ${
                            isDQ
                              ? (darkMode ? 'bg-green-600 text-white hover:bg-green-500' : 'bg-green-600 text-white hover:bg-green-500')
                              : (darkMode ? 'bg-red-600 text-white hover:bg-red-500' : 'bg-red-600 text-white hover:bg-red-500')
                          }`}
                          title={isDQ ? 'Remove DQ' : 'Mark as DQ'}
                        >
                          {isDQ ? 'Restore' : 'DQ'}
                        </button>
                      )}
                    </div>
                  );
                })}
              </div>
            )}
          </div>
          
          {/* Tie indicator */}
          {numTied > 1 && (
            <div className={`text-xs font-medium ${darkMode ? 'text-yellow-400' : 'text-yellow-600'}`}>
              ü§ù TIE: {numTied} teams
            </div>
          )}
          {/* DQ indicator */}
          {disqualifiedTeamIds.length > 0 && (
            <div className={`text-xs font-medium ${darkMode ? 'text-red-400' : 'text-red-600'}`}>
              ‚ùå DQ: {disqualifiedTeamIds.length} {disqualifiedTeamIds.length === 1 ? 'team' : 'teams'}
            </div>
          )}
        </div>
      );
    };

    // Haptic feedback for mobile devices (defined at module level for use in BulkEntryModal)
    const triggerHaptic = (style = 'light') => {
      if ('vibrate' in navigator) {
        const patterns = {
          light: [10],
          medium: [20],
          heavy: [30]
        };
        navigator.vibrate(patterns[style] || patterns.light);
      }
    };

    // Quick Entry Event Card - Team-first entry mode (inline, not modal)
    const QuickEntryEventCard = ({ event, teams, darkMode, numPlaces, pointSystem, onUpdate, onMoveUp, onMoveDown, onRemove, canMoveUp, canMoveDown, heatLockEnabled, aRelayOnly, onToggleDQ }) => {
      const isDiving = event.name === 'Diving';
      const isRelay = event.name.includes('Relay');

      // Get current selections from event results
      const getTeamPlaces = (teamId) => {
        const places = [];
        event.results.forEach(result => {
          if (result.teamIds && result.teamIds.includes(String(teamId))) {
            places.push(result.place);
          }
        });
        return places.sort((a, b) => a - b);
      };

      // Check if a team is disqualified at a specific place
      const isTeamDQ = (teamId, place) => {
        const result = event.results.find(r => r.place === place);
        if (!result || !result.disqualified) return false;
        return result.disqualified.includes(String(teamId));
      };

      // Check if any team is DQ'd at this place
      const hasAnyDQAtPlace = (place) => {
        const result = event.results.find(r => r.place === place);
        return result && result.disqualified && result.disqualified.length > 0;
      };
      
      const getPlaceLabel = (place) => {
        return place === 1 ? '1st' : place === 2 ? '2nd' : place === 3 ? '3rd' : `${place}th`;
      };
      
      // Toggle a place for a team
      const togglePlace = (teamId, place) => {
        triggerHaptic('light');
        const currentPlaces = getTeamPlaces(teamId);
        const hasPlace = currentPlaces.includes(place);
        onUpdate(event.id, place, teamId, !hasPlace);
      };
      
      // Check if a place is taken by another team (for visual indication)
      const getTeamsAtPlace = (place) => {
        const result = event.results.find(r => r.place === place);
        return result?.teamIds || [];
      };
      
      // Check if place is consumed by a tie above it
      const isPlaceConsumed = (place) => {
        for (let p = 1; p < place; p++) {
          const teamsAtP = getTeamsAtPlace(p);
          if (teamsAtP.length > 1) {
            // This place created a tie, check if current place falls within the skipped range
            if (place <= p + teamsAtP.length - 1) {
              return true;
            }
          }
        }
        return false;
      };

      return (
        <div className={`rounded-xl p-3 ${darkMode ? 'bg-pool-mid/80 border border-white/10' : 'bg-white border border-slate-200 shadow-sm'}`}>
          {/* Event Header */}
          <div className="flex items-center justify-between mb-2">
            <div className="flex items-center gap-2 flex-wrap">
              <h5 className={`font-semibold ${darkMode ? 'text-white' : 'text-slate-800'}`}>
                <span className={event.gender === 'girls' ? (darkMode ? 'text-pink-400' : 'text-pink-600') : (darkMode ? 'text-blue-400' : 'text-blue-600')}>
                  {event.gender === 'girls' ? 'G' : 'B'}
                </span>
                {' '}
                <span className={isDiving ? (darkMode ? 'text-orange-400' : 'text-orange-600') : ''}>
                  {event.name}
                </span>
              </h5>
              {/* Visual indicators for NLC/Sectionals settings */}
              {heatLockEnabled && !isRelay && (
                <span className={`text-xs px-1.5 py-0.5 rounded ${darkMode ? 'bg-amber-500/20 text-amber-400' : 'bg-amber-100 text-amber-700'}`}>
                  üîí Heat Lock
                </span>
              )}
              {aRelayOnly && isRelay && (
                <span className={`text-xs px-1.5 py-0.5 rounded ${darkMode ? 'bg-teal-500/20 text-teal-400' : 'bg-teal-100 text-teal-700'}`}>
                  üÖ∞Ô∏è A-Only
                </span>
              )}
            </div>
            <div className="flex items-center gap-1">
              <button
                onClick={onMoveUp}
                disabled={!canMoveUp}
                className={`p-1 rounded ${!canMoveUp ? 'opacity-30 cursor-not-allowed' : (darkMode ? 'hover:bg-white/10' : 'hover:bg-slate-100')} ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}
              >
                <ChevronUp className="w-4 h-4" />
              </button>
              <button
                onClick={onMoveDown}
                disabled={!canMoveDown}
                className={`p-1 rounded ${!canMoveDown ? 'opacity-30 cursor-not-allowed' : (darkMode ? 'hover:bg-white/10' : 'hover:bg-slate-100')} ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}
              >
                <ChevronDown className="w-4 h-4" />
              </button>
              <button
                onClick={onRemove}
                className={`p-1 rounded ${darkMode ? 'text-red-400 hover:bg-red-500/20' : 'text-red-500 hover:bg-red-50'}`}
              >
                <X className="w-4 h-4" />
              </button>
            </div>
          </div>
          
          {/* Team rows with place buttons */}
          <div className="space-y-2">
            {teams.map(team => {
              const teamPlaces = getTeamPlaces(team.id);
              return (
                <div key={team.id} className={`flex items-center gap-2 ${darkMode ? '' : ''}`}>
                  {/* Team name - fixed width */}
                  <div className={`w-20 sm:w-24 flex-shrink-0 text-xs font-medium truncate ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                    {team.name}
                  </div>
                  
                  {/* Place buttons - scrollable on mobile */}
                  <div className="flex gap-1 flex-wrap">
                    {Array.from({ length: numPlaces }, (_, i) => i + 1).map(place => {
                      const isSelected = teamPlaces.includes(place);
                      const teamsAtPlace = getTeamsAtPlace(place);
                      const isTie = teamsAtPlace.length > 1;
                      const hasOtherTeam = teamsAtPlace.some(id => id !== String(team.id));
                      const consumed = isPlaceConsumed(place) && !isSelected;
                      const points = pointSystem[place] || 0;
                      const isDQ = isTeamDQ(team.id, place);

                      if (consumed) {
                        return (
                          <div
                            key={place}
                            className={`w-8 h-8 sm:w-9 sm:h-9 rounded flex items-center justify-center text-xs opacity-30 ${darkMode ? 'bg-gray-700 text-gray-500' : 'bg-gray-200 text-gray-400'}`}
                            title="Consumed by tie above"
                          >
                            -
                          </div>
                        );
                      }

                      return (
                        <div key={place} className="relative">
                          <button
                            onClick={() => togglePlace(team.id, place)}
                            className={`w-8 h-8 sm:w-9 sm:h-9 rounded font-medium text-xs transition-all ${
                              isDQ
                                ? 'bg-red-600 text-white line-through opacity-70'
                                : isSelected
                                  ? (place === 1
                                      ? 'bg-gradient-to-br from-amber-400 to-amber-500 text-amber-900'
                                      : place === 2
                                        ? 'bg-gradient-to-br from-gray-300 to-gray-400 text-gray-800'
                                        : place === 3
                                          ? 'bg-gradient-to-br from-orange-400 to-orange-500 text-orange-900'
                                          : (darkMode ? 'bg-chlorine text-pool-deep' : 'bg-cyan-600 text-white'))
                                  : hasOtherTeam
                                    ? (darkMode ? 'bg-gray-600/50 text-gray-400 border border-dashed border-gray-500' : 'bg-gray-100 text-gray-400 border border-dashed border-gray-300')
                                    : (darkMode ? 'bg-gray-700/50 text-gray-400 hover:bg-gray-600 border border-gray-600' : 'bg-gray-50 text-gray-500 hover:bg-gray-100 border border-gray-200')
                            } ${isTie && isSelected && !isDQ ? 'ring-2 ring-yellow-400' : ''}`}
                            title={`${getPlaceLabel(place)} (${points}pts)${hasOtherTeam && !isSelected ? ' - taken' : ''}${isDQ ? ' - DISQUALIFIED' : ''}`}
                          >
                            {isDQ ? 'DQ' : place}
                          </button>
                          {/* DQ toggle button - appears when team is placed */}
                          {isSelected && onToggleDQ && (
                            <button
                              onClick={(e) => {
                                e.stopPropagation();
                                onToggleDQ(event.id, place, team.id);
                              }}
                              className={`absolute -top-1 -right-1 w-4 h-4 rounded-full text-[8px] font-bold flex items-center justify-center ${
                                isDQ
                                  ? (darkMode ? 'bg-green-500 text-white hover:bg-green-400' : 'bg-green-600 text-white hover:bg-green-500')
                                  : (darkMode ? 'bg-red-500 text-white hover:bg-red-400' : 'bg-red-600 text-white hover:bg-red-500')
                              }`}
                              title={isDQ ? 'Remove DQ (restore placement)' : 'Mark as Disqualified'}
                            >
                              {isDQ ? '‚úì' : 'X'}
                            </button>
                          )}
                        </div>
                      );
                    })}
                  </div>
                  
                  {/* Points earned indicator - accounts for ties, consumed places, and DQs */}
                  {teamPlaces.length > 0 && (
                    <div className={`text-xs font-medium ml-auto ${
                      teamPlaces.every(p => isTeamDQ(team.id, p))
                        ? 'text-red-500 line-through'
                        : (darkMode ? 'text-chlorine' : 'text-cyan-600')
                    }`}>
                      {(() => {
                        // Check if this team is DQ'd at all their places
                        const allDQ = teamPlaces.every(p => isTeamDQ(team.id, p));
                        if (allDQ) return 'DQ';

                        let totalPts = 0;

                        // Sort results by place and build eligible teams list (excluding DQs)
                        const sortedResults = [...event.results]
                          .filter(r => r && r.place && r.teamIds && r.teamIds.length > 0)
                          .sort((a, b) => a.place - b.place);

                        // Build list of eligible teams in order
                        const eligibleGroups = [];
                        sortedResults.forEach(result => {
                          const dqTeams = result.disqualified || [];
                          const eligibleTeams = result.teamIds.filter(id => !dqTeams.includes(String(id)));
                          if (eligibleTeams.length > 0) {
                            eligibleGroups.push({
                              originalPlace: result.place,
                              teamIds: eligibleTeams
                            });
                          }
                        });

                        // Calculate points with place shifting
                        let currentAwardPlace = 1;
                        eligibleGroups.forEach(group => {
                          if (currentAwardPlace > numPlaces) return;

                          const numTied = group.teamIds.length;

                          // Check if this team is in this group
                          if (group.teamIds.includes(String(team.id))) {
                            let tiedPoints = 0;
                            for (let i = 0; i < numTied && (currentAwardPlace + i) <= numPlaces; i++) {
                              tiedPoints += (pointSystem[currentAwardPlace + i]) || 0;
                            }
                            totalPts += tiedPoints / numTied;
                          }

                          currentAwardPlace += numTied;
                        });

                        return Math.round(totalPts * 10) / 10;
                      })()}pt
                    </div>
                  )}
                </div>
              );
            })}
          </div>
        </div>
      );
    };

    // Bulk Entry Modal - Quick entry for all places for a team
    const BulkEntryModal = ({ event, teams, darkMode, numPlaces, pointSystem, onSave, onClose, existingResults }) => {
      // Track selections for ALL teams, not just the current one
      const [allSelections, setAllSelections] = useState(() => {
        // Initialize from existing results
        const initial = {};
        teams.forEach(t => { initial[t.id] = []; });
        if (existingResults) {
          existingResults.forEach(result => {
            if (result.teamIds && result.place) {
              result.teamIds.forEach(teamId => {
                if (initial[teamId]) {
                  initial[teamId].push(result.place);
                }
              });
            }
          });
        }
        // Sort each team's places
        Object.keys(initial).forEach(k => { initial[k].sort((a, b) => a - b); });
        return initial;
      });
      
      const [selectedTeam, setSelectedTeam] = useState(teams[0]?.id || null);
      const [autoFillEnabled, setAutoFillEnabled] = useState(teams.length === 2);
      
      const selectedPlaces = allSelections[selectedTeam] || [];
      
      const togglePlace = (place) => {
        triggerHaptic('light');
        setAllSelections(prev => {
          const teamPlaces = [...(prev[selectedTeam] || [])];
          const idx = teamPlaces.indexOf(place);
          if (idx >= 0) {
            teamPlaces.splice(idx, 1);
          } else {
            teamPlaces.push(place);
            teamPlaces.sort((a, b) => a - b);
          }
          return { ...prev, [selectedTeam]: teamPlaces };
        });
      };
      
      const getPlaceLabel = (place) => {
        return place === 1 ? '1st' : place === 2 ? '2nd' : place === 3 ? '3rd' : `${place}th`;
      };
      
      // Get which team(s) have a place selected (for showing ties/other team selections)
      const getTeamsAtPlace = (place) => {
        const teamsAtPlace = [];
        Object.entries(allSelections).forEach(([teamId, places]) => {
          if (places.includes(place)) {
            teamsAtPlace.push(teamId);
          }
        });
        return teamsAtPlace;
      };
      
      // Calculate total places selected across all teams
      const getTotalPlacesSelected = () => {
        let total = 0;
        Object.values(allSelections).forEach(places => { total += places.length; });
        return total;
      };
      
      // Get place count for a specific team
      const getTeamPlaceCount = (teamId) => {
        return (allSelections[teamId] || []).length;
      };
      
      const handleSave = () => {
        // Build results from all selections
        const newResults = [];
        const placeToTeams = {};
        
        // Group teams by place
        Object.entries(allSelections).forEach(([teamId, places]) => {
          places.forEach(place => {
            if (!placeToTeams[place]) placeToTeams[place] = [];
            placeToTeams[place].push(String(teamId));
          });
        });
        
        // If dual meet and auto-fill is enabled, fill remaining places with other team
        if (autoFillEnabled && teams.length === 2) {
          const [team1, team2] = teams;
          for (let p = 1; p <= numPlaces; p++) {
            if (!placeToTeams[p] || placeToTeams[p].length === 0) {
              // Assign to the team that doesn't have this place
              const team1Has = (allSelections[team1.id] || []).includes(p);
              const team2Has = (allSelections[team2.id] || []).includes(p);
              if (!team1Has && !team2Has) {
                // Neither team has it - give to the one with fewer places
                const team1Count = (allSelections[team1.id] || []).length;
                const team2Count = (allSelections[team2.id] || []).length;
                placeToTeams[p] = [String(team1Count <= team2Count ? team1.id : team2.id)];
              }
            }
          }
        }
        
        // Convert to results format
        Object.entries(placeToTeams).forEach(([place, teamIds]) => {
          if (teamIds.length > 0) {
            newResults.push({ place: parseInt(place), teamIds });
          }
        });
        
        onSave(event.id, newResults);
        onClose();
        trackEvent('bulk_entry_save', { team_count: teams.length, places_selected: getTotalPlacesSelected(), auto_fill: autoFillEnabled });
        triggerHaptic('medium');
      };
      
      const clearAll = () => {
        triggerHaptic('light');
        setAllSelections(prev => ({ ...prev, [selectedTeam]: [] }));
      };

      return (
        <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4">
          <div className={`rounded-2xl w-full max-w-lg flex flex-col ${darkMode ? 'bg-pool-mid border border-chlorine/30' : 'bg-white'}`} style={{ maxHeight: 'calc(100vh - 16px)' }}>
            {/* Header - Compact */}
            <div className={`px-4 py-3 flex items-center justify-between border-b shrink-0 ${darkMode ? 'bg-gradient-to-r from-chlorine/20 to-transparent border-chlorine/20' : 'bg-gradient-to-r from-cyan-500 to-blue-500'}`}>
              <div className="flex items-center gap-2">
                <Zap className={`w-5 h-5 ${darkMode ? 'text-chlorine' : 'text-white'}`} />
                <div>
                  <h3 className={`text-base font-bold ${darkMode ? 'text-chlorine' : 'text-white'}`}>Quick Entry</h3>
                  <p className={`text-xs ${darkMode ? 'text-gray-400' : 'text-white/80'}`}>
                    {event.gender === 'girls' ? 'Girls' : 'Boys'} {event.name}
                  </p>
                </div>
              </div>
              <button onClick={onClose} className={`p-2 rounded-lg transition ${darkMode ? 'hover:bg-white/10' : 'hover:bg-white/20'}`}>
                <X className={`w-5 h-5 ${darkMode ? 'text-gray-300' : 'text-white'}`} />
              </button>
            </div>

            {/* Content - Scrollable only if needed */}
            <div className="flex-1 overflow-y-auto p-4">
              {/* Team Selector - Compact grid */}
              <div className="mb-3">
                <div className={`grid gap-2 ${teams.length <= 2 ? 'grid-cols-2' : teams.length <= 4 ? 'grid-cols-2' : 'grid-cols-3'}`}>
                  {teams.map(team => {
                    const placeCount = getTeamPlaceCount(team.id);
                    return (
                      <button
                        key={team.id}
                        onClick={() => { setSelectedTeam(team.id); triggerHaptic('light'); }}
                        className={`px-3 py-2 rounded-xl font-medium text-sm transition-all ${
                          selectedTeam === team.id
                            ? (darkMode ? 'bg-chlorine text-pool-deep ring-2 ring-chlorine/50' : 'bg-cyan-600 text-white ring-2 ring-cyan-300')
                            : (darkMode ? 'bg-gray-700 text-gray-300 hover:bg-gray-600' : 'bg-gray-100 text-gray-700 hover:bg-gray-200')
                        }`}
                      >
                        <span className="truncate">{team.name}</span>
                        {placeCount > 0 && (
                          <span className={`ml-1 text-xs ${selectedTeam === team.id ? 'opacity-80' : (darkMode ? 'text-gray-400' : 'text-gray-500')}`}>
                            ({placeCount})
                          </span>
                        )}
                      </button>
                    );
                  })}
                </div>
              </div>

              {/* Places Grid - Compact */}
              <div className="mb-3">
                <div className="flex items-center justify-between mb-2">
                  <span className={`text-xs ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                    Tap places for {teams.find(t => t.id === selectedTeam)?.name}
                  </span>
                  <button
                    onClick={clearAll}
                    className={`text-xs px-2 py-0.5 rounded ${darkMode ? 'text-gray-400 hover:text-gray-300 hover:bg-gray-700' : 'text-gray-500 hover:text-gray-700 hover:bg-gray-100'}`}
                  >
                    Clear
                  </button>
                </div>
                <div className="grid grid-cols-5 gap-1.5">
                  {Array.from({ length: numPlaces }, (_, i) => i + 1).map(place => {
                    const isSelected = selectedPlaces.includes(place);
                    const teamsAtPlace = getTeamsAtPlace(place);
                    const hasOtherTeam = teamsAtPlace.some(id => id !== String(selectedTeam));
                    const isTie = teamsAtPlace.length > 1;
                    const points = pointSystem[place] || 0;
                    
                    return (
                      <button
                        key={place}
                        onClick={() => togglePlace(place)}
                        className={`relative p-2 rounded-lg font-medium text-center transition-all ${
                          isSelected
                            ? (place === 1 
                                ? 'bg-gradient-to-br from-amber-400 to-amber-500 text-amber-900 ring-2 ring-amber-300' 
                                : place === 2 
                                  ? 'bg-gradient-to-br from-gray-300 to-gray-400 text-gray-800 ring-2 ring-gray-300'
                                  : place === 3 
                                    ? 'bg-gradient-to-br from-orange-400 to-orange-500 text-orange-900 ring-2 ring-orange-300'
                                    : (darkMode ? 'bg-chlorine text-pool-deep ring-2 ring-chlorine/50' : 'bg-cyan-600 text-white ring-2 ring-cyan-300'))
                            : hasOtherTeam
                              ? (darkMode ? 'bg-gray-600 text-gray-300 border-2 border-dashed border-gray-500' : 'bg-gray-200 text-gray-600 border-2 border-dashed border-gray-400')
                              : (darkMode ? 'bg-gray-700/50 text-gray-400 hover:bg-gray-600 border border-gray-600' : 'bg-gray-50 text-gray-600 hover:bg-gray-100 border border-gray-200')
                        } ${isTie ? 'ring-2 ring-yellow-400' : ''}`}
                      >
                        {isSelected && (
                          <div className="absolute -top-1 -right-1 w-3.5 h-3.5 bg-green-500 rounded-full flex items-center justify-center">
                            <Check className="w-2.5 h-2.5 text-white" />
                          </div>
                        )}
                        {isTie && (
                          <div className="absolute -top-1 -left-1 w-3.5 h-3.5 bg-yellow-500 rounded-full flex items-center justify-center text-[8px] font-bold text-yellow-900">
                            {teamsAtPlace.length}
                          </div>
                        )}
                        <div className="text-sm font-bold">{getPlaceLabel(place)}</div>
                        <div className={`text-[10px] ${isSelected ? 'opacity-80' : (darkMode ? 'text-gray-500' : 'text-gray-400')}`}>
                          {points}pt
                        </div>
                        {hasOtherTeam && !isSelected && (
                          <div className={`text-[8px] truncate ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                            {teams.find(t => teamsAtPlace.includes(String(t.id)) && t.id !== selectedTeam)?.name?.slice(0, 6)}
                          </div>
                        )}
                      </button>
                    );
                  })}
                </div>
              </div>

              {/* Auto-fill toggle for dual meets - Compact */}
              {teams.length === 2 && (
                <div className={`p-3 rounded-xl mb-3 ${darkMode ? 'bg-lane-gold/10 border border-lane-gold/30' : 'bg-amber-50 border border-amber-200'}`}>
                  <label className="flex items-center gap-2 cursor-pointer">
                    <input
                      type="checkbox"
                      checked={autoFillEnabled}
                      onChange={(e) => { setAutoFillEnabled(e.target.checked); triggerHaptic('light'); }}
                      className="w-4 h-4 rounded accent-amber-500"
                    />
                    <span className={`text-sm font-medium ${darkMode ? 'text-lane-gold' : 'text-amber-700'}`}>
                      Auto-fill remaining to {teams.find(t => t.id !== selectedTeam)?.name}
                    </span>
                  </label>
                </div>
              )}

              {/* Summary - Compact, no "Preview" heading */}
              <div className={`p-3 rounded-xl ${darkMode ? 'bg-gray-800/50' : 'bg-gray-50'}`}>
                <div className="space-y-1.5 text-sm">
                  {teams.map(team => {
                    const places = allSelections[team.id] || [];
                    if (places.length === 0) return null;
                    return (
                      <div key={team.id} className="flex items-center justify-between">
                        <span className={`${team.id === selectedTeam ? (darkMode ? 'text-chlorine font-medium' : 'text-cyan-600 font-medium') : (darkMode ? 'text-gray-400' : 'text-gray-500')}`}>
                          {team.name}:
                        </span>
                        <span className={`font-medium ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                          {places.map(p => getPlaceLabel(p)).join(', ')}
                        </span>
                      </div>
                    );
                  })}
                  {getTotalPlacesSelected() === 0 && (
                    <div className={`text-center ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>
                      No places selected
                    </div>
                  )}
                </div>
              </div>
            </div>

            {/* Footer - Fixed */}
            <div className={`px-4 py-3 border-t flex gap-2 shrink-0 ${darkMode ? 'bg-gray-800/50 border-gray-700' : 'bg-gray-50 border-gray-200'}`}>
              <button
                onClick={onClose}
                className={`flex-1 py-2.5 rounded-xl font-semibold transition text-sm ${darkMode ? 'bg-gray-700 hover:bg-gray-600 text-gray-300' : 'bg-gray-200 hover:bg-gray-300 text-gray-700'}`}
              >
                Cancel
              </button>
              <button
                onClick={handleSave}
                disabled={getTotalPlacesSelected() === 0}
                className={`flex-1 py-2.5 rounded-xl font-semibold transition flex items-center justify-center gap-1.5 text-sm ${
                  getTotalPlacesSelected() === 0
                    ? (darkMode ? 'bg-gray-700 text-gray-500 cursor-not-allowed' : 'bg-gray-200 text-gray-400 cursor-not-allowed')
                    : (darkMode ? 'bg-chlorine hover:bg-chlorine-glow text-pool-deep' : 'bg-cyan-600 hover:bg-cyan-700 text-white')
                }`}
              >
                <Check className="w-4 h-4" />
                Apply ({getTotalPlacesSelected()})</button>
            </div>
          </div>
        </div>
      );
    };

    function SwimMeetScore() {
      // Error state for user feedback
      const [error, setError] = useState(null);
      const [showConfirmDialog, setShowConfirmDialog] = useState(null);
      const [bulkEntryEvent, setBulkEntryEvent] = useState(null); // For bulk entry modal
      const [quickEntryMode, setQuickEntryMode] = useState(false); // Toggle between place-first and team-first entry modes
      
      // Clear error after 5 seconds
      useEffect(() => {
        if (error) {
          const timer = setTimeout(() => setError(null), 5000);
          return () => clearTimeout(timer);
        }
      }, [error]);

      // Capture the PWA install prompt
      useEffect(() => {
        const handleBeforeInstallPrompt = (e) => {
          // Prevent the mini-infobar from appearing on mobile
          e.preventDefault();
          // Save the event so it can be triggered later
          setDeferredPrompt(e);

          // Auto-show the install prompt after 3 seconds for first-time visitors
          // This ensures prompt() is called after preventDefault()
          const hasSeenPrompt = utils.loadFromStorage('hasSeenInstallPrompt', false);
          if (!hasSeenPrompt) {
            setTimeout(() => {
              e.prompt();
              e.userChoice.then((result) => {
                trackEvent('pwa_install_auto_prompt', { outcome: result.outcome });
                utils.saveToStorage('hasSeenInstallPrompt', true);
                setDeferredPrompt(null);
              });
            }, 3000);
          }
        };

        window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);

        return () => {
          window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);
        };
      }, []);

      // Track online/offline status with periodic check for mobile reliability
      useEffect(() => {
        const handleOnline = () => setIsOffline(false);
        const handleOffline = () => setIsOffline(true);
        
        window.addEventListener('online', handleOnline);
        window.addEventListener('offline', handleOffline);
        
        // Periodic connectivity check for mobile (events aren't always reliable)
        const checkConnectivity = () => {
          // navigator.onLine can be unreliable, but it's a good first check
          if (!navigator.onLine) {
            setIsOffline(true);
            return;
          }
          
          // Try to fetch a tiny resource to confirm actual connectivity
          fetch('/favicon.ico', { method: 'HEAD', cache: 'no-store' })
            .then(() => setIsOffline(false))
            .catch(() => setIsOffline(true));
        };
        
        // Check connectivity every 30 seconds on mobile
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        let intervalId;
        if (isMobile) {
          intervalId = setInterval(checkConnectivity, 30000);
        }
        
        return () => {
          window.removeEventListener('online', handleOnline);
          window.removeEventListener('offline', handleOffline);
          if (intervalId) clearInterval(intervalId);
        };
      }, []);

      // Function to trigger the install prompt
      const handleInstallClick = async () => {
        if (!deferredPrompt) {
          return;
        }
        // Track install attempt
        trackEvent('pwa_install_prompt');
        // Show the install prompt
        deferredPrompt.prompt();
        // Wait for the user to respond to the prompt
        const { outcome } = await deferredPrompt.userChoice;
        // Track the outcome
        trackEvent('pwa_install_outcome', { outcome: outcome });
        // Clear the deferred prompt variable
        setDeferredPrompt(null);
      };

      // Default values
      // Default teams match High School Dual Meet template
      const defaultTeams = [
        { id: 1, name: 'Home Team', score: 0, girlsScore: 0, boysScore: 0 },
        { id: 2, name: 'Away Team', score: 0, girlsScore: 0, boysScore: 0 }
      ];

      // Default events match High School Dual Meet template (diving between 50 Free and 100 Fly)
      const defaultEvents = [
        { id: 1, name: '200 Medley Relay', results: [], gender: 'girls' },
        { id: 2, name: '200 Medley Relay', results: [], gender: 'boys' },
        { id: 3, name: '200 Freestyle', results: [], gender: 'girls' },
        { id: 4, name: '200 Freestyle', results: [], gender: 'boys' },
        { id: 5, name: '200 IM', results: [], gender: 'girls' },
        { id: 6, name: '200 IM', results: [], gender: 'boys' },
        { id: 7, name: '50 Freestyle', results: [], gender: 'girls' },
        { id: 8, name: '50 Freestyle', results: [], gender: 'boys' },
        { id: 9, name: 'Diving', results: [], gender: 'girls' },
        { id: 10, name: 'Diving', results: [], gender: 'boys' },
        { id: 11, name: '100 Butterfly', results: [], gender: 'girls' },
        { id: 12, name: '100 Butterfly', results: [], gender: 'boys' },
        { id: 13, name: '100 Freestyle', results: [], gender: 'girls' },
        { id: 14, name: '100 Freestyle', results: [], gender: 'boys' },
        { id: 15, name: '500 Freestyle', results: [], gender: 'girls' },
        { id: 16, name: '500 Freestyle', results: [], gender: 'boys' },
        { id: 17, name: '200 Freestyle Relay', results: [], gender: 'girls' },
        { id: 18, name: '200 Freestyle Relay', results: [], gender: 'boys' },
        { id: 19, name: '100 Backstroke', results: [], gender: 'girls' },
        { id: 20, name: '100 Backstroke', results: [], gender: 'boys' },
        { id: 21, name: '100 Breaststroke', results: [], gender: 'girls' },
        { id: 22, name: '100 Breaststroke', results: [], gender: 'boys' },
        { id: 23, name: '400 Freestyle Relay', results: [], gender: 'girls' },
        { id: 24, name: '400 Freestyle Relay', results: [], gender: 'boys' }
      ];

      const defaultIndividualPoints = {
        1: 6, 2: 4, 3: 3, 4: 2, 5: 1, 6: 0, 7: 0, 8: 0, 9: 0, 10: 0, 11: 0, 12: 0, 13: 0, 14: 0, 15: 0, 16: 0, 17: 0, 18: 0, 19: 0, 20: 0
      };

      const defaultRelayPoints = {
        1: 8, 2: 4, 3: 2, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0, 9: 0, 10: 0, 11: 0, 12: 0, 13: 0, 14: 0, 15: 0, 16: 0, 17: 0, 18: 0, 19: 0, 20: 0
      };

      const defaultDivingPoints = {
        1: 5, 2: 3, 3: 1, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0, 9: 0, 10: 0, 11: 0, 12: 0, 13: 0, 14: 0, 15: 0, 16: 0, 17: 0, 18: 0, 19: 0, 20: 0
      };

      // State with localStorage initialization
      const CURRENT_VERSION = 4; // Version 4 adds tie support with teamIds array
      
      // Check and migrate events if needed
      const initializeEvents = () => {
        try {
          const savedVersion = utils.loadFromStorage('version', 1);
          const savedEvents = utils.loadFromStorage('events', null);
          
          if (savedVersion < 3 || !savedEvents || !Array.isArray(savedEvents)) {
            // Migrate to new version with correct diving position
            utils.saveToStorage('version', CURRENT_VERSION);
            return defaultEvents;
          }
          
          // Validate events structure
          let validEvents = savedEvents.filter(e => e && e.id && e.name && Array.isArray(e.results));
          
          // Migrate from version 3 (teamId) to version 4 (teamIds array)
          if (savedVersion < 4) {
            validEvents = validEvents.map(event => ({
              ...event,
              results: (event.results || []).map(result => {
                // If already has teamIds array, keep it
                if (result.teamIds && Array.isArray(result.teamIds)) {
                  return result;
                }
                // Migrate from teamId to teamIds array
                if (result.teamId) {
                  return { place: result.place, teamIds: [String(result.teamId)] };
                }
                return result;
              }).filter(r => r && r.place && r.teamIds && r.teamIds.length > 0)
            }));
            utils.saveToStorage('version', CURRENT_VERSION);
            utils.saveToStorage('events', validEvents);
          }
          
          return validEvents.length > 0 ? validEvents : defaultEvents;
        } catch (e) {
          console.error('Error initializing events:', e);
          return defaultEvents;
        }
      };
      
      const [teams, setTeams] = useState(() => {
        const loaded = utils.loadFromStorage('teams', defaultTeams);
        return Array.isArray(loaded) && loaded.length > 0 ? loaded : defaultTeams;
      });
      const [events, setEvents] = useState(() => initializeEvents());
      const [showSettings, setShowSettings] = useState(false);
      const [showAbout, setShowAbout] = useState(false);
      const [deferredPrompt, setDeferredPrompt] = useState(null);
      const [isOffline, setIsOffline] = useState(!navigator.onLine);
      const [newTeamName, setNewTeamName] = useState('');
      const [darkMode, setDarkMode] = useState(() => utils.loadFromStorage('darkMode', true));
      const [scoringMode, setScoringMode] = useState(() => utils.loadFromStorage('scoringMode', 'combined'));
      const [numIndividualPlaces, setNumIndividualPlaces] = useState(() => {
        const val = utils.loadFromStorage('numIndividualPlaces', 5);
        return utils.validateNumber(val, 1, 20, 5);
      });
      const [numRelayPlaces, setNumRelayPlaces] = useState(() => {
        const val = utils.loadFromStorage('numRelayPlaces', 3);
        return utils.validateNumber(val, 1, 20, 3);
      });
      const [numDivingPlaces, setNumDivingPlaces] = useState(() => {
        const val = utils.loadFromStorage('numDivingPlaces', 3);
        return utils.validateNumber(val, 1, 20, 3);
      });
      const [editingTeamId, setEditingTeamId] = useState(null);
      const [editingTeamName, setEditingTeamName] = useState('');
      const [newEventName, setNewEventName] = useState('');
      const [newEventGender, setNewEventGender] = useState('girls');
      const [newEventType, setNewEventType] = useState('individual');
      const [savedTemplates, setSavedTemplates] = useState(() => {
        const loaded = utils.loadFromStorage('savedTemplates', []);
        return Array.isArray(loaded) ? loaded : [];
      });
      const [newTemplateName, setNewTemplateName] = useState('');
      const [showSaveTemplate, setShowSaveTemplate] = useState(false);
      const [shareSuccess, setShareSuccess] = useState(false);
      
      // NLC/Sectionals specific settings
      const [heatLockEnabled, setHeatLockEnabled] = useState(() => utils.loadFromStorage('heatLockEnabled', false));
      const [aRelayOnly, setARelayOnly] = useState(() => utils.loadFromStorage('aRelayOnly', false));

      // Track which template is currently active (for visual indicator)
      const [activeTemplate, setActiveTemplate] = useState(() => utils.loadFromStorage('activeTemplate', 'high_school'));

      const [individualPointSystem, setIndividualPointSystem] = useState(() => {
        const loaded = utils.loadFromStorage('individualPointSystem', defaultIndividualPoints);
        return loaded && typeof loaded === 'object' ? loaded : defaultIndividualPoints;
      });
      const [relayPointSystem, setRelayPointSystem] = useState(() => {
        const loaded = utils.loadFromStorage('relayPointSystem', defaultRelayPoints);
        return loaded && typeof loaded === 'object' ? loaded : defaultRelayPoints;
      });
      const [divingPointSystem, setDivingPointSystem] = useState(() => {
        const loaded = utils.loadFromStorage('divingPointSystem', defaultDivingPoints);
        return loaded && typeof loaded === 'object' ? loaded : defaultDivingPoints;
      });

      // Debounced save functions to reduce localStorage writes
      const debouncedSaveTeamsRef = useRef(null);
      const debouncedSaveEventsRef = useRef(null);
      
      useEffect(() => {
        debouncedSaveTeamsRef.current = utils.debounce((data) => {
          if (!utils.saveToStorage('teams', data)) {
            setError('Failed to save teams. Storage may be full or unavailable.');
          }
        }, 500);
        
        debouncedSaveEventsRef.current = utils.debounce((data) => {
          if (!utils.saveToStorage('events', data)) {
            setError('Failed to save events. Storage may be full or unavailable.');
          }
        }, 500);
      }, []);

      // Auto-save to localStorage whenever state changes (with error handling)
      useEffect(() => {
        if (teams && Array.isArray(teams) && debouncedSaveTeamsRef.current) {
          debouncedSaveTeamsRef.current(teams);
        }
      }, [teams]);

      useEffect(() => {
        if (events && Array.isArray(events) && debouncedSaveEventsRef.current) {
          debouncedSaveEventsRef.current(events);
        }
      }, [events]);

      useEffect(() => {
        utils.saveToStorage('darkMode', darkMode);
      }, [darkMode]);

      useEffect(() => {
        utils.saveToStorage('scoringMode', scoringMode);
      }, [scoringMode]);

      useEffect(() => {
        utils.saveToStorage('numIndividualPlaces', numIndividualPlaces);
      }, [numIndividualPlaces]);

      useEffect(() => {
        utils.saveToStorage('numRelayPlaces', numRelayPlaces);
      }, [numRelayPlaces]);

      useEffect(() => {
        utils.saveToStorage('numDivingPlaces', numDivingPlaces);
      }, [numDivingPlaces]);

      useEffect(() => {
        if (savedTemplates && Array.isArray(savedTemplates)) {
          utils.saveToStorage('savedTemplates', savedTemplates);
        }
      }, [savedTemplates]);

      useEffect(() => {
        if (individualPointSystem && typeof individualPointSystem === 'object') {
          utils.saveToStorage('individualPointSystem', individualPointSystem);
        }
      }, [individualPointSystem]);

      useEffect(() => {
        if (relayPointSystem && typeof relayPointSystem === 'object') {
          utils.saveToStorage('relayPointSystem', relayPointSystem);
        }
      }, [relayPointSystem]);

      useEffect(() => {
        if (divingPointSystem && typeof divingPointSystem === 'object') {
          utils.saveToStorage('divingPointSystem', divingPointSystem);
        }
      }, [divingPointSystem]);

      useEffect(() => {
        utils.saveToStorage('heatLockEnabled', heatLockEnabled);
      }, [heatLockEnabled]);

      useEffect(() => {
        utils.saveToStorage('aRelayOnly', aRelayOnly);
      }, [aRelayOnly]);

      useEffect(() => {
        utils.saveToStorage('activeTemplate', activeTemplate);
      }, [activeTemplate]);

      // When A-Relay Only is enabled, automatically set relay places equal to number of teams
      // (since each team can only enter one relay, max places = number of teams)
      useEffect(() => {
        if (aRelayOnly && teams.length > 0) {
          const newRelayPlaces = Math.min(teams.length, 20); // Cap at 20 (max places supported)
          if (numRelayPlaces !== newRelayPlaces) {
            setNumRelayPlaces(newRelayPlaces);
          }
        }
      }, [aRelayOnly, teams.length]);

      const recalculateAllScores = useCallback((teamsList, eventsList) => {
        if (!Array.isArray(teamsList) || !Array.isArray(eventsList)) return;
        
        try {
          const scores = {};
          const girlsScores = {};
          const boysScores = {};
          
          teamsList.forEach(team => {
            if (team && team.id) {
              scores[team.id] = 0;
              girlsScores[team.id] = 0;
              boysScores[team.id] = 0;
            }
          });

          eventsList.forEach(event => {
            if (!event || !event.results || !Array.isArray(event.results)) return;

            const isDiving = event.name === 'Diving';
            const isRelay = event.name && event.name.includes('Relay');
            const pointSystem = isDiving ? divingPointSystem : isRelay ? relayPointSystem : individualPointSystem;
            const numPlaces = isDiving ? numDivingPlaces : isRelay ? numRelayPlaces : numIndividualPlaces;

            // Sort results by place
            const sortedResults = [...event.results]
              .filter(r => r && r.place && r.teamIds && Array.isArray(r.teamIds) && r.teamIds.length > 0)
              .sort((a, b) => a.place - b.place);

            // Build list of eligible (non-DQ) teams in place order
            // When a DQ happens, subsequent places shift up
            const eligibleTeamsInOrder = [];

            sortedResults.forEach(result => {
              const disqualifiedTeams = result.disqualified || [];
              const eligibleTeams = result.teamIds.filter(id => !disqualifiedTeams.includes(String(id)));

              if (eligibleTeams.length > 0) {
                eligibleTeamsInOrder.push({
                  originalPlace: result.place,
                  teamIds: eligibleTeams
                });
              }
            });

            // Calculate points with place shifting for DQs
            // Eligible teams are awarded points based on their new shifted positions
            let currentAwardPlace = 1;

            eligibleTeamsInOrder.forEach(group => {
              if (currentAwardPlace > numPlaces) return;

              const numTied = group.teamIds.length;

              // Sum up points for all places consumed by this tie
              let totalPoints = 0;
              for (let i = 0; i < numTied && (currentAwardPlace + i) <= numPlaces; i++) {
                totalPoints += (pointSystem && pointSystem[currentAwardPlace + i]) || 0;
              }

              // Split points evenly among tied teams
              const pointsPerTeam = numTied > 0 ? totalPoints / numTied : 0;

              group.teamIds.forEach(teamId => {
                if (teamId) {
                  scores[teamId] = (scores[teamId] || 0) + pointsPerTeam;

                  if (event.gender === 'girls') {
                    girlsScores[teamId] = (girlsScores[teamId] || 0) + pointsPerTeam;
                  } else if (event.gender === 'boys') {
                    boysScores[teamId] = (boysScores[teamId] || 0) + pointsPerTeam;
                  }
                }
              });

              // Move to next available place (skip consumed places from ties)
              currentAwardPlace += numTied;
            });
          });

          setTeams(teamsList.map(team => ({
            ...team,
            score: Math.round((scores[team.id] || 0) * 100) / 100,
            girlsScore: Math.round((girlsScores[team.id] || 0) * 100) / 100,
            boysScore: Math.round((boysScores[team.id] || 0) * 100) / 100
          })));
        } catch (e) {
          console.error('Error recalculating scores:', e);
          setError('Error calculating scores. Please refresh the page.');
        }
      }, [individualPointSystem, relayPointSystem, divingPointSystem, numIndividualPlaces, numRelayPlaces, numDivingPlaces]);

      const addTeam = () => {
        const validation = utils.validateTeamName(newTeamName);
        if (!validation.valid) {
          setError(validation.error);
          return;
        }
        
        // Check for duplicate team names
        const trimmedName = validation.value;
        if (teams.some(t => t.name.toLowerCase() === trimmedName.toLowerCase())) {
          setError('A team with this name already exists.');
          return;
        }
        
        // Check maximum teams limit (prevent performance issues)
        if (teams.length >= 50) {
          setError('Maximum of 50 teams allowed.');
          return;
        }
        
        try {
          setTeams([...teams, { 
            id: utils.generateId(), 
            name: trimmedName, 
            score: 0,
            girlsScore: 0,
            boysScore: 0
          }]);
          setNewTeamName('');
          setError(null);
          // Track event
          trackEvent('add_team', { team_count: teams.length + 1 });
        } catch (e) {
          console.error('Error adding team:', e);
          setError('Failed to add team. Please try again.');
        }
      };

      const removeTeam = (id) => {
        // Prevent removing all teams
        if (teams.length <= 1) {
          setError('At least one team is required.');
          return;
        }
        
        try {
          const newTeams = teams.filter(t => t && t.id !== id);
          setTeams(newTeams);
          recalculateAllScores(newTeams, events);
          setError(null);
        } catch (e) {
          console.error('Error removing team:', e);
          setError('Failed to remove team. Please try again.');
        }
      };

      const startEditingTeam = (team) => {
        setEditingTeamId(team.id);
        setEditingTeamName(team.name);
      };

      const saveTeamName = (teamId) => {
        const validation = utils.validateTeamName(editingTeamName);
        if (!validation.valid) {
          setError(validation.error);
          return;
        }
        
        // Check for duplicate names (excluding current team)
        const trimmedName = validation.value;
        if (teams.some(t => t.id !== teamId && t.name.toLowerCase() === trimmedName.toLowerCase())) {
          setError('A team with this name already exists.');
          return;
        }
        
        try {
          const newTeams = teams.map(team => 
            team.id === teamId ? { ...team, name: trimmedName } : team
          );
          setTeams(newTeams);
          setEditingTeamId(null);
          setEditingTeamName('');
          setError(null);
        } catch (e) {
          console.error('Error saving team name:', e);
          setError('Failed to save team name. Please try again.');
        }
      };

      const cancelEditingTeam = () => {
        setEditingTeamId(null);
        setEditingTeamName('');
      };

      const addEvent = () => {
        const validation = utils.validateEventName(newEventName, newEventType);
        if (!validation.valid) {
          setError(validation.error);
          return;
        }
        
        // Check maximum events limit
        if (events.length >= 100) {
          setError('Maximum of 100 events allowed.');
          return;
        }
        
        try {
          let eventName;
          if (newEventType === 'diving') {
            eventName = 'Diving';
          } else if (newEventType === 'relay') {
            eventName = `${validation.value} Relay`;
          } else {
            eventName = validation.value;
          }
          
          setEvents([...events, {
            id: utils.generateId(),
            name: eventName,
            results: [],
            gender: newEventGender
          }]);
          setNewEventName('');
          setError(null);
          // Track event
          trackEvent('add_event', { event_type: newEventType, event_count: events.length + 1 });
        } catch (e) {
          console.error('Error adding event:', e);
          setError('Failed to add event. Please try again.');
        }
      };

      const removeEvent = (id) => {
        setShowConfirmDialog({
          message: 'Are you sure you want to delete this event? All results for this event will be lost.',
          onConfirm: () => {
            try {
              const newEvents = events.filter(e => e && e.id !== id);
              setEvents(newEvents);
              recalculateAllScores(teams, newEvents);
              setShowConfirmDialog(null);
            } catch (e) {
              console.error('Error removing event:', e);
              setError('Failed to remove event. Please try again.');
              setShowConfirmDialog(null);
            }
          },
          onCancel: () => setShowConfirmDialog(null)
        });
      };

      const moveEventUp = (index) => {
        if (index === 0) return;
        const newEvents = [...events];
        [newEvents[index - 1], newEvents[index]] = [newEvents[index], newEvents[index - 1]];
        setEvents(newEvents);
      };

      const moveEventDown = (index) => {
        if (index === events.length - 1) return;
        const newEvents = [...events];
        [newEvents[index], newEvents[index + 1]] = [newEvents[index + 1], newEvents[index]];
        setEvents(newEvents);
      };

      const saveTemplate = () => {
        const validation = utils.validateTemplateName(newTemplateName);
        if (!validation.valid) {
          setError(validation.error);
          return;
        }
        
        // Check for duplicate template names
        const trimmedName = validation.value;
        if (savedTemplates.some(t => t.name.toLowerCase() === trimmedName.toLowerCase())) {
          setError('A template with this name already exists.');
          return;
        }
        
        // Check maximum templates limit
        if (savedTemplates.length >= 20) {
          setError('Maximum of 20 templates allowed.');
          return;
        }
        
        try {
          const template = {
            id: utils.generateId(),
            name: trimmedName,
            numIndividualPlaces,
            numRelayPlaces,
            numDivingPlaces,
            individualPointSystem: { ...individualPointSystem },
            relayPointSystem: { ...relayPointSystem },
            divingPointSystem: { ...divingPointSystem },
            events: events.map(e => e ? { name: e.name, gender: e.gender } : null).filter(Boolean)
          };
          setSavedTemplates([...savedTemplates, template]);
          setNewTemplateName('');
          setShowSaveTemplate(false);
          setError(null);
        } catch (e) {
          console.error('Error saving template:', e);
          setError('Failed to save template. Please try again.');
        }
      };

      const loadTemplate = (template) => {
        if (!template) {
          setError('Invalid template.');
          return;
        }
        
        try {
          setNumIndividualPlaces(utils.validateNumber(template.numIndividualPlaces, 1, 20, 5));
          setNumRelayPlaces(utils.validateNumber(template.numRelayPlaces, 1, 20, 3));
          setNumDivingPlaces(utils.validateNumber(template.numDivingPlaces, 1, 20, 3));
          
          if (template.individualPointSystem && typeof template.individualPointSystem === 'object') {
            setIndividualPointSystem({ ...template.individualPointSystem });
          }
          if (template.relayPointSystem && typeof template.relayPointSystem === 'object') {
            setRelayPointSystem({ ...template.relayPointSystem });
          }
          if (template.divingPointSystem && typeof template.divingPointSystem === 'object') {
            setDivingPointSystem({ ...template.divingPointSystem });
          }
          
          if (template.events && Array.isArray(template.events)) {
            const newEvents = template.events
              .filter(e => e && e.name && e.gender)
              .map((e, index) => ({
                id: utils.generateId(),
                name: e.name,
                gender: e.gender,
                results: []
              }));
            setEvents(newEvents);
            recalculateAllScores(teams, newEvents);
          } else {
            recalculateAllScores(teams, events);
          }
          // Set active template to custom template id
          setActiveTemplate('custom_' + template.id);
          setError(null);
        } catch (e) {
          console.error('Error loading template:', e);
          setError('Failed to load template. Template may be corrupted.');
        }
      };

      const deleteTemplate = (id) => {
        setSavedTemplates(savedTemplates.filter(t => t.id !== id));
      };

      // Helper to clear active template when user manually changes settings
      const handleManualSettingChange = (setter) => (value) => {
        setActiveTemplate(null);
        setter(value);
      };

      const updateEventResult = (eventId, place, teamId, isChecked) => {
        try {
          // Validate inputs
          if (!eventId || !place || place < 1) return;
          if (teamId && !teams.some(t => t && t.id == teamId)) return; // Validate team exists
          
          const newEvents = events.map(event => {
            if (event && event.id === eventId) {
              const newResults = [...(event.results || [])];
              const existingIndex = newResults.findIndex(r => r && r.place === place);
              
              if (existingIndex >= 0) {
                // Place already has entries
                const currentTeamIds = [...(newResults[existingIndex].teamIds || [])];
                
                if (isChecked && teamId) {
                  // Add team to this place if not already there
                  if (!currentTeamIds.includes(String(teamId))) {
                    currentTeamIds.push(String(teamId));
                  }
                } else if (!isChecked && teamId) {
                  // Remove team from this place
                  const teamIndex = currentTeamIds.indexOf(String(teamId));
                  if (teamIndex >= 0) {
                    currentTeamIds.splice(teamIndex, 1);
                  }
                }
                
                if (currentTeamIds.length === 0) {
                  // Remove the place entry if no teams left
                  newResults.splice(existingIndex, 1);
                } else {
                  newResults[existingIndex] = { place, teamIds: currentTeamIds };
                }
              } else if (isChecked && teamId) {
                // Create new place entry
                newResults.push({ place, teamIds: [String(teamId)] });
              }
              
              return { ...event, results: newResults };
            }
            return event;
          });
          
          setEvents(newEvents);
          recalculateAllScores(teams, newEvents);
          // Track result recording and provide haptic feedback (only when adding, not removing)
          if (isChecked && teamId) {
            trackEvent('record_result', { place: place });
            triggerHaptic('light');
          }
        } catch (e) {
          console.error('Error updating event result:', e);
          setError('Failed to update result. Please try again.');
        }
      };

      // Bulk update event results - replaces all results for an event
      const bulkUpdateEventResults = (eventId, newResults) => {
        try {
          if (!eventId) return;
          
          const newEvents = events.map(event => {
            if (event && event.id === eventId) {
              return { ...event, results: newResults };
            }
            return event;
          });
          
          setEvents(newEvents);
          recalculateAllScores(teams, newEvents);
        } catch (e) {
          console.error('Error bulk updating event results:', e);
          setError('Failed to update results. Please try again.');
        }
      };

      // Toggle disqualification status for a team at a specific place
      // When a team is DQ'd, subsequent places shift up and points are awarded to new places
      const toggleDisqualification = (eventId, place, teamId) => {
        try {
          if (!eventId || !place || !teamId) return;

          const newEvents = events.map(event => {
            if (event && event.id === eventId) {
              const newResults = event.results.map(result => {
                if (result && result.place === place) {
                  const currentDQ = result.disqualified || [];
                  const teamIdStr = String(teamId);
                  const isCurrentlyDQ = currentDQ.includes(teamIdStr);

                  if (isCurrentlyDQ) {
                    // Remove DQ status
                    return {
                      ...result,
                      disqualified: currentDQ.filter(id => id !== teamIdStr)
                    };
                  } else {
                    // Add DQ status
                    return {
                      ...result,
                      disqualified: [...currentDQ, teamIdStr]
                    };
                  }
                }
                return result;
              });
              return { ...event, results: newResults };
            }
            return event;
          });

          setEvents(newEvents);
          recalculateAllScores(teams, newEvents);
          triggerHaptic('medium');
        } catch (e) {
          console.error('Error toggling disqualification:', e);
          setError('Failed to update disqualification. Please try again.');
        }
      };

      const clearAllDataKeepTemplates = () => {
        setShowConfirmDialog({
          message: 'Clear all data (teams, events, scores) but keep your saved templates?',
          onConfirm: () => {
            try {
              setTeams(defaultTeams);
              setEvents(defaultEvents);
              setIndividualPointSystem(defaultIndividualPoints);
              setRelayPointSystem(defaultRelayPoints);
              setDivingPointSystem(defaultDivingPoints);
              setNumIndividualPlaces(5);
              setNumRelayPlaces(3);
              setNumDivingPlaces(3);
              // Reset Heat Lock and A-Relay settings to defaults (off)
              setHeatLockEnabled(false);
              setARelayOnly(false);
              // Reset active template to default (High School)
              setActiveTemplate('high_school');

              utils.saveToStorage('teams', defaultTeams);
              utils.saveToStorage('events', defaultEvents);
              utils.saveToStorage('individualPointSystem', defaultIndividualPoints);
              utils.saveToStorage('relayPointSystem', defaultRelayPoints);
              utils.saveToStorage('divingPointSystem', defaultDivingPoints);
              utils.saveToStorage('numIndividualPlaces', 5);
              utils.saveToStorage('numRelayPlaces', 3);
              utils.saveToStorage('numDivingPlaces', 3);
              utils.saveToStorage('heatLockEnabled', false);
              utils.saveToStorage('aRelayOnly', false);
              utils.saveToStorage('activeTemplate', 'high_school');
              utils.saveToStorage('version', CURRENT_VERSION);

              recalculateAllScores(defaultTeams, defaultEvents);
              setShowConfirmDialog(null);
            } catch (e) {
              console.error('Error clearing data:', e);
              setError('Failed to clear data. Please try again.');
              setShowConfirmDialog(null);
            }
          },
          onCancel: () => setShowConfirmDialog(null)
        });
      };

      const clearAllDataAndTemplates = () => {
        setShowConfirmDialog({
          message: 'Clear ALL data including saved templates? This cannot be undone.',
          onConfirm: () => {
            try {
              // Clear everything including templates
              localStorage.clear();

              setTeams(defaultTeams);
              setEvents(defaultEvents);
              setIndividualPointSystem(defaultIndividualPoints);
              setRelayPointSystem(defaultRelayPoints);
              setDivingPointSystem(defaultDivingPoints);
              setNumIndividualPlaces(5);
              setNumRelayPlaces(3);
              setNumDivingPlaces(3);
              setSavedTemplates([]);
              setDarkMode(true);
              setScoringMode('combined');
              // Reset Heat Lock and A-Relay settings to defaults (off)
              setHeatLockEnabled(false);
              setARelayOnly(false);
              // Reset active template to default (High School)
              setActiveTemplate('high_school');

              utils.saveToStorage('version', CURRENT_VERSION);
              recalculateAllScores(defaultTeams, defaultEvents);
              setShowConfirmDialog(null);
            } catch (e) {
              console.error('Error clearing all data:', e);
              setError('Failed to clear all data. Please try again.');
              setShowConfirmDialog(null);
            }
          },
          onCancel: () => setShowConfirmDialog(null)
        });
      };

      useEffect(() => {
        recalculateAllScores(teams, events);
        // eslint-disable-next-line react-hooks/exhaustive-deps
      }, [scoringMode]);

      const sortedTeams = useMemo(() => {
        if (!Array.isArray(teams) || teams.length === 0) return [];
        return [...teams].sort((a, b) => {
          if (!a || !b) return 0;
          if (scoringMode === 'girls') {
            return (b.girlsScore || 0) - (a.girlsScore || 0);
          } else if (scoringMode === 'boys') {
            return (b.boysScore || 0) - (a.boysScore || 0);
          }
          return (b.score || 0) - (a.score || 0);
        });
      }, [teams, scoringMode]);

      const getPlacesArray = (event) => {
        if (!event || !event.name) return [];
        const isDiving = event.name === 'Diving';
        const isRelay = event.name.includes('Relay');
        const numPlaces = isDiving ? numDivingPlaces : isRelay ? numRelayPlaces : numIndividualPlaces;
        return Array.from({ length: numPlaces }, (_, i) => i + 1);
      };

      // Calculate which places are consumed by ties (skipped places)
      const getConsumedPlaces = (event) => {
        const consumed = new Set();
        if (!event || !event.results) return consumed;
        
        const isDiving = event.name === 'Diving';
        const isRelay = event.name.includes('Relay');
        const numPlaces = isDiving ? numDivingPlaces : isRelay ? numRelayPlaces : numIndividualPlaces;
        
        // Sort results by place
        const sortedResults = [...event.results]
          .filter(r => r && r.place && r.teamIds && r.teamIds.length > 0)
          .sort((a, b) => a.place - b.place);
        
        sortedResults.forEach(result => {
          const numTied = result.teamIds.length;
          if (numTied > 1) {
            // Mark subsequent places as consumed
            for (let i = 1; i < numTied && (result.place + i) <= numPlaces; i++) {
              consumed.add(result.place + i);
            }
          }
        });
        
        return consumed;
      };

      const highSchoolEvents = [
        { name: '200 Medley Relay', gender: 'girls' },
        { name: '200 Medley Relay', gender: 'boys' },
        { name: '200 Freestyle', gender: 'girls' },
        { name: '200 Freestyle', gender: 'boys' },
        { name: '200 IM', gender: 'girls' },
        { name: '200 IM', gender: 'boys' },
        { name: '50 Freestyle', gender: 'girls' },
        { name: '50 Freestyle', gender: 'boys' },
        { name: 'Diving', gender: 'girls' },
        { name: 'Diving', gender: 'boys' },
        { name: '100 Butterfly', gender: 'girls' },
        { name: '100 Butterfly', gender: 'boys' },
        { name: '100 Freestyle', gender: 'girls' },
        { name: '100 Freestyle', gender: 'boys' },
        { name: '500 Freestyle', gender: 'girls' },
        { name: '500 Freestyle', gender: 'boys' },
        { name: '200 Freestyle Relay', gender: 'girls' },
        { name: '200 Freestyle Relay', gender: 'boys' },
        { name: '100 Backstroke', gender: 'girls' },
        { name: '100 Backstroke', gender: 'boys' },
        { name: '100 Breaststroke', gender: 'girls' },
        { name: '100 Breaststroke', gender: 'boys' },
        { name: '400 Freestyle Relay', gender: 'girls' },
        { name: '400 Freestyle Relay', gender: 'boys' }
      ];

      const competitionEvents = [
        { name: '200 Medley Relay', gender: 'girls' },
        { name: '200 Medley Relay', gender: 'boys' },
        { name: '200 Freestyle', gender: 'girls' },
        { name: '200 Freestyle', gender: 'boys' },
        { name: '200 IM', gender: 'girls' },
        { name: '200 IM', gender: 'boys' },
        { name: '50 Freestyle', gender: 'girls' },
        { name: '50 Freestyle', gender: 'boys' },
        { name: '100 Butterfly', gender: 'girls' },
        { name: '100 Butterfly', gender: 'boys' },
        { name: '100 Freestyle', gender: 'girls' },
        { name: '100 Freestyle', gender: 'boys' },
        { name: '500 Freestyle', gender: 'girls' },
        { name: '500 Freestyle', gender: 'boys' },
        { name: '200 Freestyle Relay', gender: 'girls' },
        { name: '200 Freestyle Relay', gender: 'boys' },
        { name: '100 Backstroke', gender: 'girls' },
        { name: '100 Backstroke', gender: 'boys' },
        { name: '100 Breaststroke', gender: 'girls' },
        { name: '100 Breaststroke', gender: 'boys' },
        { name: '400 Freestyle Relay', gender: 'girls' },
        { name: '400 Freestyle Relay', gender: 'boys' }
      ];

      const loadHighSchoolMeet = () => {
        setNumIndividualPlaces(5);
        setNumRelayPlaces(3);
        setNumDivingPlaces(3);
        setIndividualPointSystem({
          1: 6, 2: 4, 3: 3, 4: 2, 5: 1, 6: 0, 7: 0, 8: 0, 9: 0, 10: 0, 11: 0, 12: 0, 13: 0, 14: 0, 15: 0, 16: 0, 17: 0, 18: 0, 19: 0, 20: 0
        });
        setRelayPointSystem({
          1: 8, 2: 4, 3: 2, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0, 9: 0, 10: 0, 11: 0, 12: 0, 13: 0, 14: 0, 15: 0, 16: 0, 17: 0, 18: 0, 19: 0, 20: 0
        });
        setDivingPointSystem({
          1: 5, 2: 3, 3: 1, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0, 9: 0, 10: 0, 11: 0, 12: 0, 13: 0, 14: 0, 15: 0, 16: 0, 17: 0, 18: 0, 19: 0, 20: 0
        });
        // Disable NLC/Sectionals-specific features
        setHeatLockEnabled(false);
        setARelayOnly(false);
        // Set 2 default teams for dual meet
        const dualMeetTeams = [
          { id: utils.generateId(), name: 'Home Team', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Away Team', score: 0, girlsScore: 0, boysScore: 0 }
        ];
        setTeams(dualMeetTeams);
        const newEvents = highSchoolEvents.map((e) => ({
          id: utils.generateId(),
          name: e.name,
          gender: e.gender,
          results: []
        }));
        setEvents(newEvents);
        recalculateAllScores(dualMeetTeams, newEvents);
        setActiveTemplate('high_school');
        // Track event
        trackEvent('load_template', { template_name: 'high_school_meet' });
      };

      const loadChampionshipMeet = () => {
        setNumIndividualPlaces(16);
        setNumRelayPlaces(16);
        setNumDivingPlaces(16);
        setIndividualPointSystem({
          1: 20, 2: 17, 3: 16, 4: 15, 5: 14, 6: 13, 7: 12, 8: 11, 9: 9, 10: 7, 11: 6, 12: 5, 13: 4, 14: 3, 15: 2, 16: 1, 17: 0, 18: 0, 19: 0, 20: 0
        });
        setRelayPointSystem({
          1: 40, 2: 34, 3: 32, 4: 30, 5: 28, 6: 26, 7: 24, 8: 22, 9: 18, 10: 14, 11: 12, 12: 10, 13: 8, 14: 6, 15: 4, 16: 2, 17: 0, 18: 0, 19: 0, 20: 0
        });
        setDivingPointSystem({
          1: 20, 2: 17, 3: 16, 4: 15, 5: 14, 6: 13, 7: 12, 8: 11, 9: 9, 10: 7, 11: 6, 12: 5, 13: 4, 14: 3, 15: 2, 16: 1, 17: 0, 18: 0, 19: 0, 20: 0
        });
        // Disable NLC/Sectionals-specific features
        setHeatLockEnabled(false);
        setARelayOnly(false);
        // Set 8 default teams for championship meet
        const championshipTeams = [
          { id: utils.generateId(), name: 'Team 1', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 2', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 3', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 4', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 5', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 6', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 7', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 8', score: 0, girlsScore: 0, boysScore: 0 }
        ];
        setTeams(championshipTeams);
        const newEvents = competitionEvents.map((e) => ({
          id: utils.generateId(),
          name: e.name,
          gender: e.gender,
          results: []
        }));
        setEvents(newEvents);
        recalculateAllScores(championshipTeams, newEvents);
        setActiveTemplate('championship_16');
        // Track event
        trackEvent('load_template', { template_name: 'championship_meet' });
      };

      const loadChampionshipMeet8 = () => {
        setNumIndividualPlaces(8);
        setNumRelayPlaces(8);
        setNumDivingPlaces(8);
        setIndividualPointSystem({
          1: 11, 2: 9, 3: 8, 4: 7, 5: 6, 6: 5, 7: 4, 8: 3, 9: 0, 10: 0, 11: 0, 12: 0, 13: 0, 14: 0, 15: 0, 16: 0, 17: 0, 18: 0, 19: 0, 20: 0
        });
        setRelayPointSystem({
          1: 22, 2: 18, 3: 16, 4: 14, 5: 12, 6: 10, 7: 8, 8: 6, 9: 0, 10: 0, 11: 0, 12: 0, 13: 0, 14: 0, 15: 0, 16: 0, 17: 0, 18: 0, 19: 0, 20: 0
        });
        setDivingPointSystem({
          1: 11, 2: 9, 3: 8, 4: 7, 5: 6, 6: 5, 7: 4, 8: 3, 9: 0, 10: 0, 11: 0, 12: 0, 13: 0, 14: 0, 15: 0, 16: 0, 17: 0, 18: 0, 19: 0, 20: 0
        });
        // Disable NLC/Sectionals-specific features
        setHeatLockEnabled(false);
        setARelayOnly(false);
        // Set 8 default teams for championship meet
        const championshipTeams = [
          { id: utils.generateId(), name: 'Team 1', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 2', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 3', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 4', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 5', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 6', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 7', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 8', score: 0, girlsScore: 0, boysScore: 0 }
        ];
        setTeams(championshipTeams);
        const newEvents = competitionEvents.map((e) => ({
          id: utils.generateId(),
          name: e.name,
          gender: e.gender,
          results: []
        }));
        setEvents(newEvents);
        recalculateAllScores(championshipTeams, newEvents);
        setActiveTemplate('championship_8');
        // Track event
        trackEvent('load_template', { template_name: 'championship_meet_8' });
      };

      // NLC Meet - 16 places individual, 8 places relay (A-relay only), heat lock enabled
      const loadNLCMeet = () => {
        setNumIndividualPlaces(16);
        setNumRelayPlaces(8);
        setNumDivingPlaces(16);
        setIndividualPointSystem({
          1: 20, 2: 17, 3: 16, 4: 15, 5: 14, 6: 13, 7: 12, 8: 11, 9: 9, 10: 7, 11: 6, 12: 5, 13: 4, 14: 3, 15: 2, 16: 1, 17: 0, 18: 0, 19: 0, 20: 0
        });
        setRelayPointSystem({
          1: 40, 2: 34, 3: 32, 4: 30, 5: 28, 6: 26, 7: 24, 8: 22, 9: 0, 10: 0, 11: 0, 12: 0, 13: 0, 14: 0, 15: 0, 16: 0, 17: 0, 18: 0, 19: 0, 20: 0
        });
        setDivingPointSystem({
          1: 20, 2: 17, 3: 16, 4: 15, 5: 14, 6: 13, 7: 12, 8: 11, 9: 9, 10: 7, 11: 6, 12: 5, 13: 4, 14: 3, 15: 2, 16: 1, 17: 0, 18: 0, 19: 0, 20: 0
        });
        // Enable NLC-specific features
        setHeatLockEnabled(true);
        setARelayOnly(true);
        // Set 8 default teams for NLC meet
        const nlcTeams = [
          { id: utils.generateId(), name: 'Team 1', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 2', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 3', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 4', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 5', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 6', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 7', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 8', score: 0, girlsScore: 0, boysScore: 0 }
        ];
        setTeams(nlcTeams);
        const newEvents = competitionEvents.map((e) => ({
          id: utils.generateId(),
          name: e.name,
          gender: e.gender,
          results: []
        }));
        setEvents(newEvents);
        recalculateAllScores(nlcTeams, newEvents);
        setActiveTemplate('nlc');
        trackEvent('load_template', { template_name: 'nlc_meet' });
      };

      // Sectionals - 16 places individual, 16 places relay (A-relay only, double points), heat lock enabled
      const loadSectionalsMeet = () => {
        setNumIndividualPlaces(16);
        setNumDivingPlaces(16);
        setIndividualPointSystem({
          1: 20, 2: 17, 3: 16, 4: 15, 5: 14, 6: 13, 7: 12, 8: 11, 9: 9, 10: 7, 11: 6, 12: 5, 13: 4, 14: 3, 15: 2, 16: 1, 17: 0, 18: 0, 19: 0, 20: 0
        });
        // Relay points are double the individual points for all 20 places (to support up to 20 teams)
        setRelayPointSystem({
          1: 40, 2: 34, 3: 32, 4: 30, 5: 28, 6: 26, 7: 24, 8: 22, 9: 18, 10: 14, 11: 12, 12: 10, 13: 8, 14: 6, 15: 4, 16: 2, 17: 1, 18: 1, 19: 1, 20: 1
        });
        setDivingPointSystem({
          1: 20, 2: 17, 3: 16, 4: 15, 5: 14, 6: 13, 7: 12, 8: 11, 9: 9, 10: 7, 11: 6, 12: 5, 13: 4, 14: 3, 15: 2, 16: 1, 17: 0, 18: 0, 19: 0, 20: 0
        });
        // Enable Sectionals-specific features
        setHeatLockEnabled(true);
        setARelayOnly(true);
        // Set 10 default teams for Sectionals (typical entry size)
        const sectionalsTeams = [
          { id: utils.generateId(), name: 'Team 1', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 2', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 3', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 4', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 5', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 6', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 7', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 8', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 9', score: 0, girlsScore: 0, boysScore: 0 },
          { id: utils.generateId(), name: 'Team 10', score: 0, girlsScore: 0, boysScore: 0 }
        ];
        setTeams(sectionalsTeams);
        // For Sectionals with A-relay only, relay places = number of teams (one relay per team)
        setNumRelayPlaces(sectionalsTeams.length);
        const newEvents = competitionEvents.map((e) => ({
          id: utils.generateId(),
          name: e.name,
          gender: e.gender,
          results: []
        }));
        setEvents(newEvents);
        recalculateAllScores(sectionalsTeams, newEvents);
        setActiveTemplate('sectionals');
        trackEvent('load_template', { template_name: 'sectionals_meet' });
      };

      // Generate shareable score text
      const generateShareText = () => {
        const modeLabel = scoringMode === 'combined' ? '' : scoringMode === 'girls' ? ' (Girls)' : ' (Boys)';
        const sortedTeams = [...teams].sort((a, b) => {
          const scoreA = scoringMode === 'girls' ? a.girlsScore : scoringMode === 'boys' ? a.boysScore : a.score;
          const scoreB = scoringMode === 'girls' ? b.girlsScore : scoringMode === 'boys' ? b.boysScore : b.score;
          return scoreB - scoreA;
        });
        
        let text = `üèä Swim Meet Scores${modeLabel}\n\n`;
        
        sortedTeams.forEach((team, index) => {
          const score = scoringMode === 'girls' ? team.girlsScore : scoringMode === 'boys' ? team.boysScore : team.score;
          const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : '  ';
          
          if (scoringMode === 'combined') {
            // Show breakdown for combined mode
            text += `${medal} #${index + 1} ${team.name}: ${score} pts (G: ${team.girlsScore}, B: ${team.boysScore})\n`;
          } else {
            text += `${medal} #${index + 1} ${team.name}: ${score} pts\n`;
          }
        });
        
        text += `\nüìä Scored with SwimMeetScore\n`;
        text += `https://swimmeetscore.com`;
        
        // Add extra newlines at end for email clients that append signatures
        text += `\n\n\n`;
        
        return text;
      };

      // Share scores via native share or clipboard
      const shareScores = async () => {
        const text = generateShareText();
        
        // Track the share attempt
        trackEvent('share_scores', { method: navigator.share ? 'native' : 'clipboard', scoring_mode: scoringMode });
        
        // Try native share first (mobile)
        if (navigator.share) {
          try {
            await navigator.share({
              title: 'Swim Meet Scores',
              text: text
            });
            return;
          } catch (err) {
            // User cancelled or share failed, fall back to clipboard
            if (err.name === 'AbortError') return;
          }
        }
        
        // Fall back to clipboard
        try {
          await navigator.clipboard.writeText(text);
          setError(null);
          // Show success message briefly using error state (we'll style it differently)
          const originalError = error;
          setShareSuccess(true);
          setTimeout(() => setShareSuccess(false), 3000);
        } catch (err) {
          setError('Failed to copy to clipboard');
        }
      };

      // Print QR Code for spectators
      const printQRCode = () => {
        trackEvent('print_qr_code');
        
        // Create print window with US Letter sizing
        const printWindow = window.open('', '_blank', 'width=850,height=1100');
        
        const htmlContent = '<!DOCTYPE html>' +
          '<html>' +
          '<head>' +
            '<title>SwimMeetScore QR Code</title>' +
            '<style>' +
              '@page { size: letter; margin: 0; }' +
              '* { margin: 0; padding: 0; box-sizing: border-box; }' +
              'html, body { width: 8.5in; height: 11in; }' +
              'body { font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 0.5in; text-align: center; }' +
              '.header { margin-bottom: 0.4in; }' +
              '.header h1 { font-size: 36pt; font-weight: bold; color: #0891b2; margin-bottom: 0.15in; line-height: 1.2; }' +
              '.header p { font-size: 16pt; color: #374151; }' +
              '.qr-container { padding: 0.25in; border: 4px solid #0891b2; border-radius: 0.2in; background: white; margin-bottom: 0.4in; }' +
              '.qr-code { width: 3.5in; height: 3.5in; display: block; }' +
              '.url { font-size: 24pt; font-weight: bold; color: #0891b2; margin-bottom: 0.25in; }' +
              '.tagline { font-size: 14pt; color: #6b7280; max-width: 6in; line-height: 1.4; }' +
              '.swimmer-icon { margin-top: 0.25in; font-size: 36pt; }' +
              '@media print { html, body { width: 100%; height: 100%; } body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } }' +
            '</style>' +
          '</head>' +
          '<body>' +
            '<div class="header">' +
              '<h1>üèä Scan to Track<br/>Live Swim Meet Scores!</h1>' +
              '<p>Point your phone camera at the QR code below</p>' +
            '</div>' +
            '<div class="qr-container">' +
              '<img src="https://api.qrserver.com/v1/create-qr-code/?size=350x350&data=https://swimmeetscore.com" class="qr-code" alt="QR Code for SwimMeetScore.com" />' +
            '</div>' +
            '<div class="url">SwimMeetScore.com</div>' +
            '<div class="tagline">Free swim meet scoring tool ‚Äî Track scores in real-time!<br/>Works on any phone ‚Ä¢ No app download required</div>' +
            '<div class="swimmer-icon">üèÜ</div>' +
          '</body>' +
          '</html>';
        
        printWindow.document.write(htmlContent);
        printWindow.document.close();
        
        // Wait for content to load then trigger print
        printWindow.onload = function() {
          setTimeout(function() {
            printWindow.print();
          }, 250);
        };
      };

      // Email formatted results
      const emailResults = () => {
        trackEvent('email_results', { scoring_mode: scoringMode });
        
        const modeLabel = scoringMode === 'combined' ? '' : scoringMode === 'girls' ? ' (Girls Only)' : ' (Boys Only)';
        const sortedTeams = [...teams].sort((a, b) => {
          const scoreA = scoringMode === 'girls' ? a.girlsScore : scoringMode === 'boys' ? a.boysScore : a.score;
          const scoreB = scoringMode === 'girls' ? b.girlsScore : scoringMode === 'boys' ? b.boysScore : b.score;
          return scoreB - scoreA;
        });
        
        // Filter events based on scoring mode
        const filteredEvents = scoringMode === 'combined' 
          ? events 
          : events.filter(e => e.gender === scoringMode);
        
        const subject = encodeURIComponent('Swim Meet Results' + modeLabel);
        
        let body = 'SWIM MEET RESULTS' + modeLabel.toUpperCase() + '\n';
        body += '================================\n\n';
        body += 'FINAL STANDINGS:\n\n';
        
        sortedTeams.forEach((team, index) => {
          const score = scoringMode === 'girls' ? team.girlsScore : scoringMode === 'boys' ? team.boysScore : team.score;
          const place = index + 1;
          const placeStr = place === 1 ? '1st' : place === 2 ? '2nd' : place === 3 ? '3rd' : place + 'th';
          body += placeStr + ' Place: ' + team.name + ' - ' + score + ' points\n';
        });
        
        if (scoringMode === 'combined' && sortedTeams.length > 0) {
          body += '\n--------------------------------\n';
          body += 'BREAKDOWN BY GENDER:\n\n';
          body += 'Girls Scores:\n';
          [...teams].sort((a, b) => b.girlsScore - a.girlsScore).forEach((team, index) => {
            body += '  ' + (index + 1) + '. ' + team.name + ': ' + team.girlsScore + ' pts\n';
          });
          body += '\nBoys Scores:\n';
          [...teams].sort((a, b) => b.boysScore - a.boysScore).forEach((team, index) => {
            body += '  ' + (index + 1) + '. ' + team.name + ': ' + team.boysScore + ' pts\n';
          });
        }
        
        // Add event-by-event results
        if (filteredEvents.length > 0) {
          body += '\n================================\n';
          body += 'EVENT-BY-EVENT RESULTS:\n';
          body += '================================\n\n';
          
          filteredEvents.forEach((event) => {
            const genderPrefix = scoringMode === 'combined' ? (event.gender === 'girls' ? 'Girls ' : 'Boys ') : '';
            body += genderPrefix + event.name + ':\n';
            
            if (event.results && event.results.length > 0) {
              // Sort results by place
              const sortedResults = [...event.results].sort((a, b) => a.place - b.place);
              
              sortedResults.forEach((result) => {
                const placeNum = result.place;
                const placeStr = placeNum === 1 ? '1st' : placeNum === 2 ? '2nd' : placeNum === 3 ? '3rd' : placeNum + 'th';
                const dqTeams = result.disqualified || [];

                // Show eligible teams (not DQ'd)
                const eligibleTeamIds = result.teamIds.filter(id => !dqTeams.includes(String(id)));
                const eligibleTeamNames = eligibleTeamIds.map(id => {
                  const team = teams.find(t => String(t.id) === String(id));
                  return team ? team.name : 'Unknown';
                }).join(', ');

                // Show DQ'd teams separately
                const dqTeamNames = dqTeams.map(id => {
                  const team = teams.find(t => String(t.id) === String(id));
                  return team ? team.name : 'Unknown';
                }).join(', ');

                if (eligibleTeamIds.length > 0) {
                  if (eligibleTeamIds.length > 1) {
                    body += '  ' + placeStr + ' (TIE): ' + eligibleTeamNames + '\n';
                  } else {
                    body += '  ' + placeStr + ': ' + eligibleTeamNames + '\n';
                  }
                }

                // Show DQ'd teams
                if (dqTeams.length > 0) {
                  body += '  ' + placeStr + ' (DQ): ' + dqTeamNames + '\n';
                }
              });
            } else {
              body += '  (No results recorded)\n';
            }
            body += '\n';
          });
        }
        
        body += '================================\n';
        body += 'Scored with SwimMeetScore.com\n';
        body += 'Free swim meet scoring tool\n';
        
        const mailtoLink = 'mailto:?subject=' + subject + '&body=' + encodeURIComponent(body);
        window.location.href = mailtoLink;
      };

      return (
        <div className={`min-h-screen p-4 font-outfit ${darkMode ? 'bg-pool-deep' : 'bg-gradient-to-b from-sky-100 via-cyan-50 to-blue-100'}`} style={darkMode ? {background: 'linear-gradient(180deg, #0c1929 0%, #0f2942 50%, #164e6e 100%)'} : {}}>
          {/* Pool lane pattern overlay for dark mode */}
          {darkMode && (
            <div className="fixed inset-0 pointer-events-none opacity-[0.03]" style={{
              backgroundImage: 'repeating-linear-gradient(90deg, transparent 0px, transparent 80px, #fbbf24 80px, #fbbf24 84px)',
            }} />
          )}
          <div className="max-w-6xl mx-auto">
            {/* Error Message Display */}
            {error && (
              <div className={`mb-4 p-4 rounded-lg flex items-center justify-between ${darkMode ? 'bg-red-900 text-red-100' : 'bg-red-100 text-red-800'}`}>
                <span>{error}</span>
                <button
                  onClick={() => setError(null)}
                  className="ml-4 text-red-500 hover:text-red-700"
                >
                  <X className="w-5 h-5" />
                </button>
              </div>
            )}

            {/* Share Success Message */}
            {shareSuccess && (
              <div className={`mb-4 p-4 rounded-lg flex items-center gap-3 ${darkMode ? 'bg-green-900 text-green-100' : 'bg-green-100 text-green-800'}`}>
                <span>‚úì Scores copied to clipboard!</span>
              </div>
            )}

            {/* Offline Indicator */}
            {isOffline && (
              <div className={`mb-4 p-3 rounded-lg flex items-center gap-3 ${darkMode ? 'bg-cyan-900/70 text-cyan-100 border border-cyan-700' : 'bg-cyan-100 text-cyan-800 border border-cyan-300'}`}>
                <span className="text-lg">üì∂</span>
                <span><strong>Offline Mode</strong> ‚Äî No worries! The app works offline. Your data is saved locally.</span>
              </div>
            )}

            {/* Confirmation Dialog */}
            {showConfirmDialog && (
              <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div className={`rounded-lg p-6 max-w-md w-full ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
                  <h3 className={`text-lg font-bold mb-4 ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                    Confirm Action
                  </h3>
                  <p className={`mb-6 ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>
                    {showConfirmDialog.message}
                  </p>
                  <div className="flex gap-3 justify-end">
                    <button
                      onClick={showConfirmDialog.onCancel}
                      className={`px-4 py-2 rounded-lg ${darkMode ? 'bg-gray-700 hover:bg-gray-600 text-white' : 'bg-gray-200 hover:bg-gray-300 text-gray-800'}`}
                    >
                      Cancel
                    </button>
                    <button
                      onClick={showConfirmDialog.onConfirm}
                      className="px-4 py-2 rounded-lg bg-red-600 hover:bg-red-700 text-white"
                    >
                      Confirm
                    </button>
                  </div>
                </div>
              </div>
            )}

            {/* Bulk Entry Modal */}
            {bulkEntryEvent && (
              <BulkEntryModal
                event={bulkEntryEvent}
                teams={teams}
                darkMode={darkMode}
                numPlaces={
                  bulkEntryEvent.name === 'Diving' 
                    ? numDivingPlaces 
                    : bulkEntryEvent.name.includes('Relay') 
                      ? numRelayPlaces 
                      : numIndividualPlaces
                }
                pointSystem={
                  bulkEntryEvent.name === 'Diving' 
                    ? divingPointSystem 
                    : bulkEntryEvent.name.includes('Relay') 
                      ? relayPointSystem 
                      : individualPointSystem
                }
                existingResults={bulkEntryEvent.results}
                onSave={bulkUpdateEventResults}
                onClose={() => setBulkEntryEvent(null)}
              />
            )}

            {/* About/Help Modal */}
            {showAbout && (
              <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div className={`rounded-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
                  {/* Header */}
                  <div className={`px-6 py-4 flex items-center justify-between border-b ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-gray-50 border-gray-200'}`}>
                    <div className="flex items-center gap-3">
                      <HelpCircle className={`w-6 h-6 ${darkMode ? 'text-cyan-400' : 'text-blue-600'}`} />
                      <h3 className={`text-xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>Help & Instructions</h3>
                    </div>
                    <button
                      onClick={() => setShowAbout(false)}
                      className={`p-2 rounded-lg transition ${darkMode ? 'hover:bg-gray-600' : 'hover:bg-gray-200'}`}
                    >
                      <X className={`w-5 h-5 ${darkMode ? 'text-gray-300' : 'text-gray-600'}`} />
                    </button>
                  </div>

                  {/* Scrollable Content */}
                  <div className={`flex-1 overflow-y-auto p-6 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                    {/* About Section */}
                    <section className="mb-8">
                      <h4 className={`text-lg font-semibold mb-3 ${darkMode ? 'text-white' : 'text-gray-800'}`}>üèä About Swim Meet Score</h4>
                      <p className="mb-3">
                        Swim Meet Score is a free, ad-free tool for tracking scores during swim meets. Perfect for coaches, parents, and officials at high school and competitive swimming events.
                      </p>
                      
                      {/* QR Code for Spectators - Meet Organizers */}
                      <div className={`p-4 rounded-lg ${darkMode ? 'bg-cyan-900/50 border border-cyan-700' : 'bg-cyan-50 border border-cyan-200'}`}>
                        <h5 className={`font-semibold mb-1 ${darkMode ? 'text-cyan-400' : 'text-cyan-700'}`}>üì± For Meet Organizers: QR Code Poster</h5>
                        <p className={`text-xs mb-2 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>(Spectators can skip this section)</p>
                        <p className={`text-sm mb-3 ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>
                          Print a QR code poster so spectators can scan and track scores on their own phones ‚Äî no printed score sheets needed!
                        </p>
                        <button
                          onClick={printQRCode}
                          className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition ${darkMode ? 'bg-cyan-600 hover:bg-cyan-700 text-white' : 'bg-cyan-600 hover:bg-cyan-700 text-white'}`}
                        >
                          <Printer className="w-5 h-5" />
                          Print QR Code Poster
                        </button>
                      </div>
                      
                      <p className={`mt-6 text-sm ${darkMode ? 'text-cyan-400' : 'text-cyan-700'}`}>
                        üì∂ <strong>Works at pools with poor cell service!</strong> Once loaded, the app works completely offline.
                      </p>
                    </section>

                    {/* Install on Phone */}
                    <section className="mb-8">
                      <h4 className={`text-lg font-semibold mb-3 ${darkMode ? 'text-white' : 'text-gray-800'}`}>‚Üíüì± Install on Your Phone</h4>
                      
                      <div className={`p-4 rounded-lg mb-4 ${darkMode ? 'bg-gray-700' : 'bg-blue-50'}`}>
                        <h5 className={`font-semibold mb-2 ${darkMode ? 'text-blue-400' : 'text-blue-700'}`}>iPhone / iPad (Safari)</h5>
                        <ol className="list-decimal list-inside space-y-1 text-sm">
                          <li>Open swimmeetscore.com in Safari</li>
                          <li>Tap the Share button (square with arrow)</li>
                          <li>Scroll down and tap "Add to Home Screen"</li>
                          <li>Tap "Add" to confirm</li>
                        </ol>
                      </div>

                      <div className={`p-4 rounded-lg ${darkMode ? 'bg-gray-700' : 'bg-green-50'}`}>
                        <h5 className={`font-semibold mb-2 ${darkMode ? 'text-green-400' : 'text-green-700'}`}>Android (Chrome)</h5>
                        
                        {deferredPrompt ? (
                          <div className="mb-3">
                            <button
                              onClick={handleInstallClick}
                              className="w-full py-3 px-4 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg transition flex items-center justify-center gap-2"
                            >
                              <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
                              </svg>
                              Install App Now
                            </button>
                            <p className={`text-xs mt-2 text-center ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                              Click above to add Swim Meet Score to your home screen
                            </p>
                          </div>
                        ) : (
                          <div className={`mb-3 p-3 rounded-lg text-sm ${darkMode ? 'bg-gray-600 text-gray-300' : 'bg-green-100 text-green-800'}`}>
                            <p className="font-medium mb-1">üì± Already installed or not available?</p>
                            <p className="text-xs">The install button appears automatically on Android Chrome. If you don't see it, you may have already installed the app, or try the manual steps below.</p>
                          </div>
                        )}
                        
                        <p className={`text-xs font-medium mb-2 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>Or install manually:</p>
                        <ol className="list-decimal list-inside space-y-1 text-sm">
                          <li>Open swimmeetscore.com in Chrome</li>
                          <li>Tap the three-dot menu (‚ãÆ) in the top right</li>
                          <li>Tap "Add to Home screen" or "Install app"</li>
                          <li>Tap "Add" or "Install" to confirm</li>
                        </ol>
                      </div>
                    </section>

                    {/* How to Use */}
                    <section className="mb-8">
                      <h4 className={`text-lg font-semibold mb-3 ${darkMode ? 'text-white' : 'text-gray-800'}`}>üèä How to Use</h4>
                      <ol className="list-decimal list-inside space-y-2">
                        <li><strong>Add Teams:</strong> Go to Settings and add your competing teams</li>
                        <li><strong>Choose a Template:</strong> Select "High School Dual Meet" or "Competition Mode" for preset events and point systems, or customize your own</li>
                        <li><strong>Record Results:</strong> For each event, select the team(s) that placed 1st, 2nd, 3rd, etc.</li>
                        <li><strong>View Scores:</strong> The scoreboard updates automatically as you enter results</li>
                      </ol>
                    </section>

                    {/* Quick Entry Mode */}
                    <section className="mb-8">
                      <h4 className={`text-lg font-semibold mb-3 ${darkMode ? 'text-white' : 'text-gray-800'}`}>‚ö° Quick Entry Mode</h4>
                      <p className="mb-3">
                        Toggle Quick Mode ON for faster score entry, especially on mobile. This mode shows a compact view where you tap place numbers directly for each team.
                      </p>
                      
                      <div className={`p-4 rounded-lg mb-4 ${darkMode ? 'bg-lane-gold/20 border border-lane-gold/30' : 'bg-amber-50 border border-amber-200'}`}>
                        <h5 className={`font-semibold mb-2 ${darkMode ? 'text-lane-gold' : 'text-amber-700'}`}>üöÄ How to Use Quick Mode</h5>
                        <ol className="text-sm space-y-1 list-decimal list-inside">
                          <li>Click the <strong>"Quick Mode"</strong> button next to the Events header</li>
                          <li>Each event shows a row per team with numbered place buttons</li>
                          <li>Tap place numbers (1, 2, 3...) to assign them to each team</li>
                          <li>Scores update instantly - no save button needed!</li>
                        </ol>
                      </div>
                      
                      <div className={`p-4 rounded-lg mb-4 ${darkMode ? 'bg-gray-700' : 'bg-gray-100'}`}>
                        <h5 className={`font-semibold mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>üìã Two Entry Modes</h5>
                        <div className="text-sm space-y-2">
                          <p><strong>Quick Mode OFF (Default):</strong> Pick teams for each place using dropdowns. Best for recording ties.</p>
                          <p><strong>Quick Mode ON:</strong> Tap place numbers for each team. Faster for mobile and dual meets.</p>
                        </div>
                      </div>
                      
                      <div className={`p-4 rounded-lg ${darkMode ? 'bg-green-900/30 border border-green-700/50' : 'bg-green-50 border border-green-200'}`}>
                        <h5 className={`font-semibold mb-2 ${darkMode ? 'text-green-400' : 'text-green-700'}`}>üéØ Tips for Quick Mode</h5>
                        <ul className="text-sm space-y-1">
                          <li>‚Ä¢ Each team's row shows their total points earned</li>
                          <li>‚Ä¢ Grayed numbers with dashes (-) are consumed by ties above</li>
                          <li>‚Ä¢ Dashed borders show places already taken by another team</li>
                          <li>‚Ä¢ Gold/silver/bronze colors highlight 1st/2nd/3rd places</li>
                        </ul>
                      </div>
                    </section>

                    {/* Tie Handling */}
                    <section className="mb-8">
                      <h4 className={`text-lg font-semibold mb-3 ${darkMode ? 'text-white' : 'text-gray-800'}`}>ü§ù How Ties Are Handled</h4>
                      <p className="mb-3">
                        Swim Meet Score follows official tie-breaking rules used in competitive swimming:
                      </p>
                      
                      {/* How to Record a Tie */}
                      <div className={`p-4 rounded-lg mb-4 ${darkMode ? 'bg-cyan-900/50 border border-cyan-700' : 'bg-cyan-50 border border-cyan-200'}`}>
                        <h5 className={`font-semibold mb-2 ${darkMode ? 'text-cyan-400' : 'text-cyan-700'}`}>üìù How to Record a Tie</h5>
                        <ol className="text-sm space-y-1 list-decimal list-inside">
                          <li>Click on the place dropdown (1st, 2nd, etc.)</li>
                          <li>Check the boxes for ALL teams that tied for that place</li>
                          <li>The app will automatically calculate split points and skip places</li>
                        </ol>
                        <p className={`text-xs mt-2 ${darkMode ? 'text-cyan-300' : 'text-cyan-600'}`}>
                          üí° You'll see a yellow highlight and "TIE" indicator when multiple teams are selected
                        </p>
                      </div>
                      
                      <div className={`p-4 rounded-lg mb-4 ${darkMode ? 'bg-gray-700' : 'bg-yellow-50'}`}>
                        <h5 className={`font-semibold mb-2 ${darkMode ? 'text-yellow-400' : 'text-yellow-700'}`}>‚ûó Point Splitting</h5>
                        <p className="text-sm mb-2">When swimmers tie, the points for the tied places are added together and split evenly.</p>
                        <div className={`text-sm p-3 rounded ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
                          <p className="font-medium mb-1">Example - Dual Meet (6-4-3-2-1 scoring):</p>
                          <p>‚Ä¢ Two swimmers tie for 1st: (6 + 4) √∑ 2 = <strong>5 pts each</strong></p>
                          <p className="mt-2 font-medium mb-1">Example - Championship (20-17-16-15... scoring):</p>
                          <p>‚Ä¢ Two swimmers tie for 1st: (20 + 17) √∑ 2 = <strong>18.5 pts each</strong></p>
                          <p>‚Ä¢ Three swimmers tie for 2nd: (17 + 16 + 15) √∑ 3 = <strong>16 pts each</strong></p>
                        </div>
                      </div>

                      <div className={`p-4 rounded-lg mb-4 ${darkMode ? 'bg-gray-700' : 'bg-orange-50'}`}>
                        <h5 className={`font-semibold mb-2 ${darkMode ? 'text-orange-400' : 'text-orange-700'}`}>‚è≠ Place Skipping</h5>
                        <p className="text-sm mb-2">After a tie, subsequent places are skipped based on how many swimmers tied.</p>
                        <div className={`text-sm p-3 rounded ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
                          <p className="font-medium mb-1">Examples:</p>
                          <p>‚Ä¢ 2 swimmers tie for 1st ‚Üí Next finisher gets <strong>3rd place</strong> (2nd skipped)</p>
                          <p>‚Ä¢ 3 swimmers tie for 2nd ‚Üí Next finisher gets <strong>5th place</strong> (3rd & 4th skipped)</p>
                          <p>‚Ä¢ 2 swimmers tie for 5th ‚Üí Next finisher gets <strong>7th place</strong> (6th skipped)</p>
                        </div>
                        <p className={`text-xs mt-2 ${darkMode ? 'text-orange-300' : 'text-orange-600'}`}>
                          Skipped places will appear grayed out with "(tied above)" in the app
                        </p>
                      </div>

                      <div className={`p-4 rounded-lg ${darkMode ? 'bg-gray-700' : 'bg-purple-50'}`}>
                        <h5 className={`font-semibold mb-2 ${darkMode ? 'text-purple-400' : 'text-purple-700'}`}>üèÜ Complete Tie Example</h5>
                        <p className="text-sm mb-2">Dual meet scoring (6-4-3-2-1) with Team A and Team B:</p>
                        <div className={`text-sm p-3 rounded ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
                          <p>‚Ä¢ 1st Place: Team A & Team B tie ‚Üí Each gets 5 pts (6+4√∑2)</p>
                          <p>‚Ä¢ 2nd Place: <span className="italic text-gray-500">(skipped - consumed by tie)</span></p>
                          <p>‚Ä¢ 3rd Place: Team A ‚Üí Gets 3 pts</p>
                          <p>‚Ä¢ 4th Place: Team B ‚Üí Gets 2 pts</p>
                          <p>‚Ä¢ 5th Place: Team A ‚Üí Gets 1 pt</p>
                          <p className="mt-2 font-medium">Final: Team A = 9 pts, Team B = 7 pts</p>
                        </div>
                      </div>
                    </section>

                    {/* Tips */}
                    <section className="mb-8">
                      <h4 className={`text-lg font-semibold mb-3 ${darkMode ? 'text-white' : 'text-gray-800'}`}>üí° Tips</h4>
                      <ul className="space-y-2">
                        <li>‚Ä¢ <strong>Quick Mode:</strong> Toggle "Quick Mode" next to Events header for faster mobile entry - tap place numbers directly for each team</li>
                        <li>‚Ä¢ <strong>Works Offline:</strong> Once loaded, works without internet - perfect for pools with bad service!</li>
                        <li>‚Ä¢ <strong>Save Templates:</strong> Create custom templates for your league's specific scoring rules</li>
                        <li>‚Ä¢ <strong>Dark Mode:</strong> Use dark mode for better visibility at indoor pools</li>
                        <li>‚Ä¢ <strong>Data Persists:</strong> Your data stays saved even if you close the browser</li>
                        <li>‚Ä¢ <strong>Share Scores:</strong> Tap the Share button on the Scoreboard to quickly send team standings via text or social media</li>
                        <li>‚Ä¢ <strong>Email Results:</strong> Tap the Email Results button next to Events to send a complete meet report including final standings and all event-by-event results with places</li>
                        <li>‚Ä¢ <strong>Clear Data:</strong> Start fresh anytime from Settings ‚Üí Clear Data</li>
                      </ul>
                    </section>

                    {/* NLC/Sectionals Templates */}
                    <section className="mb-8">
                      <h4 className={`text-lg font-semibold mb-3 ${darkMode ? 'text-white' : 'text-gray-800'}`}>üèÖ NLC & Sectionals Templates</h4>
                      <p className="mb-3">
                        These templates are designed for championship-style meets with prelims/finals heat structures.
                      </p>
                      
                      <div className={`p-4 rounded-lg mb-4 ${darkMode ? 'bg-amber-900/30 border border-amber-700/50' : 'bg-amber-50 border border-amber-200'}`}>
                        <h5 className={`font-semibold mb-2 ${darkMode ? 'text-amber-400' : 'text-amber-700'}`}>NLC Meet Template</h5>
                        <ul className={`text-sm space-y-1 ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>
                          <li>‚Ä¢ <strong>Individual Events:</strong> 16 places scored (20-17-16-15-14-13-12-11-9-7-6-5-4-3-2-1)</li>
                          <li>‚Ä¢ <strong>Relays:</strong> 8 places, A-relay only, double points (40-34-32-30-28-26-24-22)</li>
                          <li>‚Ä¢ <strong>B-relays</strong> are exhibition (non-scoring)</li>
                          <li>‚Ä¢ <strong>Heat Lock enabled:</strong> Consolation swimmers locked to places 9-16</li>
                        </ul>
                      </div>
                      
                      <div className={`p-4 rounded-lg mb-4 ${darkMode ? 'bg-teal-900/30 border border-teal-700/50' : 'bg-teal-50 border border-teal-200'}`}>
                        <h5 className={`font-semibold mb-2 ${darkMode ? 'text-teal-400' : 'text-teal-700'}`}>Sectionals Template</h5>
                        <ul className={`text-sm space-y-1 ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>
                          <li>‚Ä¢ <strong>Individual Events:</strong> 16 places scored (20-17-16-15-14-13-12-11-9-7-6-5-4-3-2-1)</li>
                          <li>‚Ä¢ <strong>Relays:</strong> A-relay only, places = number of teams, double points</li>
                          <li>‚Ä¢ <strong>Dynamic relay places:</strong> Since each team enters one A-relay, relay places automatically match team count (e.g., 11 teams = 11 relay places)</li>
                          <li>‚Ä¢ <strong>Heat Lock enabled:</strong> Consolation swimmers locked to places 9-16</li>
                        </ul>
                      </div>
                      
                      <div className={`p-4 rounded-lg ${darkMode ? 'bg-gray-700' : 'bg-gray-100'}`}>
                        <h5 className={`font-semibold mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>Key Difference: NLC vs Sectionals</h5>
                        <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                          NLC scores relays to a fixed 8 places. Sectionals relay places dynamically match the number of teams (since only A-relays are allowed). Both use double points for relays compared to individual events.
                        </p>
                      </div>
                    </section>

                    {/* Heat Lock & A-Relay Settings */}
                    <section className="mb-8">
                      <h4 className={`text-lg font-semibold mb-3 ${darkMode ? 'text-white' : 'text-gray-800'}`}>üîí Heat Lock & A-Relay Settings</h4>
                      <p className="mb-3">
                        Found in Settings under "NLC/Sectionals Options". These are visual reminders for championship meet scoring rules.
                      </p>
                      
                      <div className={`p-4 rounded-lg mb-4 ${darkMode ? 'bg-amber-900/30 border border-amber-700/50' : 'bg-amber-50 border border-amber-200'}`}>
                        <h5 className={`font-semibold mb-2 ${darkMode ? 'text-amber-400' : 'text-amber-700'}`}>üîí Heat Lock (Prelims/Finals)</h5>
                        <p className={`text-sm mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>
                          When enabled, displays a reminder on individual events that consolation heat swimmers are locked to places 9-16, while finals swimmers compete for places 1-8.
                        </p>
                        <p className={`text-xs ${darkMode ? 'text-amber-300' : 'text-amber-600'}`}>
                          <strong>Note:</strong> This is a visual reminder - you still manually enter which places each team earned.
                        </p>
                      </div>
                      
                      <div className={`p-4 rounded-lg ${darkMode ? 'bg-teal-900/30 border border-teal-700/50' : 'bg-teal-50 border border-teal-200'}`}>
                        <h5 className={`font-semibold mb-2 ${darkMode ? 'text-teal-400' : 'text-teal-700'}`}>üÖ∞Ô∏è A-Relay Only Scoring</h5>
                        <p className={`text-sm mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>
                          When enabled, displays a reminder on relay events that only A-relays score points. B-relays are exhibition and don't count toward team scores.
                        </p>
                        <p className={`text-xs ${darkMode ? 'text-teal-300' : 'text-teal-600'}`}>
                          <strong>Note:</strong> This is a visual reminder - simply don't enter results for B-relays, or enter them for record-keeping knowing they won't affect your manual score calculations.
                        </p>
                      </div>
                    </section>

                    {/* Scoring Modes */}
                    <section className="mb-8">
                      <h4 className={`text-lg font-semibold mb-3 ${darkMode ? 'text-white' : 'text-gray-800'}`}>üìä Scoring Modes</h4>
                      <ul className="space-y-2">
                        <li>‚Ä¢ <strong>Combined:</strong> Shows total team scores (boys + girls)</li>
                        <li>‚Ä¢ <strong>Girls Only:</strong> Shows only girls' events and scores</li>
                        <li>‚Ä¢ <strong>Boys Only:</strong> Shows only boys' events and scores</li>
                      </ul>
                    </section>

                    {/* Sharing & Emailing */}
                    <section>
                      <h4 className={`text-lg font-semibold mb-3 ${darkMode ? 'text-white' : 'text-gray-800'}`}>üì§ Sharing & Emailing Results</h4>
                      
                      <div className={`p-4 rounded-lg mb-4 ${darkMode ? 'bg-cyan-900/30 border border-cyan-700/50' : 'bg-cyan-50 border border-cyan-200'}`}>
                        <h5 className={`font-semibold mb-2 ${darkMode ? 'text-cyan-400' : 'text-cyan-700'}`}>Share Button (Quick Share)</h5>
                        <p className={`text-sm mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>
                          Located on the Scoreboard. Quickly shares team standings with medal emojis via text, social media, or copies to clipboard.
                        </p>
                        <p className={`text-xs ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                          Best for: Quick updates during the meet, social media posts
                        </p>
                      </div>
                      
                      <div className={`p-4 rounded-lg ${darkMode ? 'bg-amber-900/30 border border-amber-700/50' : 'bg-amber-50 border border-amber-200'}`}>
                        <h5 className={`font-semibold mb-2 ${darkMode ? 'text-amber-400' : 'text-amber-700'}`}>Email Results Button (Full Report)</h5>
                        <p className={`text-sm mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>
                          Located next to the Events heading. Opens your email app with a complete meet report including:
                        </p>
                        <ul className={`text-sm space-y-1 ml-4 ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>
                          <li>‚Ä¢ Final team standings with points</li>
                          <li>‚Ä¢ Gender breakdown (Combined mode)</li>
                          <li>‚Ä¢ Event-by-event results with all places</li>
                          <li>‚Ä¢ Tie indicators where applicable</li>
                        </ul>
                        <p className={`text-xs mt-2 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                          Best for: Post-meet reports to coaches, parents, athletic directors
                        </p>
                      </div>
                    </section>
                  </div>

                  {/* Footer */}
                  <div className={`px-6 py-4 border-t ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-gray-50 border-gray-200'}`}>
                    <button
                      onClick={() => setShowAbout(false)}
                      className={`w-full py-3 rounded-lg font-semibold transition ${darkMode ? 'bg-cyan-600 hover:bg-cyan-700 text-white' : 'bg-blue-600 hover:bg-blue-700 text-white'}`}
                    >
                      Got It!
                    </button>
                  </div>
                </div>
              </div>
            )}

            <div className={`rounded-2xl shadow-xl p-4 sm:p-6 mb-6 backdrop-blur-sm ${darkMode ? 'bg-pool-mid/80 border border-chlorine/20' : 'bg-white/90 border border-cyan-200'}`}>
              <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 gap-3">
                <div className="flex items-center gap-3">
                  <div className={`p-2 rounded-xl ${darkMode ? 'bg-chlorine/20' : 'bg-cyan-100'}`}>
                    <Swimmer className={`w-8 h-8 ${darkMode ? 'text-chlorine' : 'text-cyan-600'}`} />
                  </div>
                  <div>
                    <h1 className={`text-2xl sm:text-3xl font-bold tracking-tight ${darkMode ? 'text-white' : 'text-slate-800'}`}>
                      Swim Meet <span className={darkMode ? 'text-chlorine' : 'text-cyan-600'}>Score</span>
                    </h1>
                  </div>
                </div>
                <div className="flex items-center gap-2">
                  <button
                    onClick={() => { setShowAbout(true); trackEvent('open_help'); }}
                    className={`flex items-center gap-2 px-4 py-2.5 rounded-xl transition text-sm font-medium ${darkMode ? 'bg-pool-light/50 hover:bg-pool-light text-white border border-white/10' : 'bg-cyan-50 hover:bg-cyan-100 text-cyan-700 border border-cyan-200'}`}
                  >
                    <HelpCircle className="w-5 h-5" />
                    Help & Info
                  </button>
                  <button
                    onClick={() => {
                      setShowSettings(!showSettings);
                      if (!showSettings) {
                        setTimeout(() => window.scrollTo({ top: 0, behavior: 'smooth' }), 100);
                        trackEvent('open_settings');
                      }
                    }}
                    className={`flex items-center gap-2 px-4 py-2.5 rounded-xl transition text-sm font-medium ${darkMode ? 'bg-chlorine/20 hover:bg-chlorine/30 text-chlorine border border-chlorine/30' : 'bg-cyan-600 hover:bg-cyan-700 text-white'}`}
                  >
                    <Settings className="w-5 h-5" />
                    Settings
                  </button>
                </div>
              </div>
              
              {/* SEO-friendly description */}
              <p className={`text-sm mb-6 ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>
                Free swimming scoresheet and swim meet scoring tool. Track team scores, individual events, relays, and diving. High school dual meet scoresheet, championship meets, and more ‚Äî use instantly, no download required!
              </p>

              {showSettings && (
                <div className={`rounded-2xl mb-6 mt-6 relative overflow-hidden ${darkMode ? 'bg-pool-mid border border-chlorine/30' : 'bg-white border border-cyan-200 shadow-xl'}`}>
                  {/* Settings Header Bar */}
                  <div className={`px-4 sm:px-6 py-4 flex items-center justify-between ${darkMode ? 'bg-chlorine/20' : 'bg-gradient-to-r from-cyan-500 to-blue-500'}`}>
                    <div className="flex items-center gap-3">
                      <Settings className={`w-6 h-6 ${darkMode ? 'text-chlorine' : 'text-white'}`} />
                      <h3 className={`text-xl font-bold ${darkMode ? 'text-chlorine' : 'text-white'}`}>Settings</h3>
                    </div>
                    <button
                      onClick={() => setShowSettings(false)}
                      className={`p-2 rounded-lg transition ${darkMode ? 'bg-white/10 hover:bg-white/20' : 'bg-white/20 hover:bg-white/30'}`}
                    >
                      <X className={`w-5 h-5 ${darkMode ? 'text-white' : 'text-white'}`} />
                    </button>
                  </div>

                  {/* Settings Content */}
                  <div className="p-4 sm:p-6">
                  <div className="mb-6">
                    <h4 className={`font-semibold mb-2 ${darkMode ? 'text-white' : 'text-slate-800'}`}>Appearance</h4>
                    <label className="flex items-center gap-3 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={darkMode}
                        onChange={(e) => setDarkMode(e.target.checked)}
                        className="w-5 h-5 rounded accent-cyan-500"
                      />
                      <span className={darkMode ? 'text-slate-200' : 'text-slate-700'}>Dark Mode</span>
                    </label>
                  </div>

                  <div className="mb-6">
                    <h4 className={`font-semibold mb-2 ${darkMode ? 'text-white' : 'text-slate-800'}`}>NLC/Sectionals Options</h4>
                    <p className={`text-sm mb-3 ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>
                      Special scoring rules for NLC meets and Sectionals.
                    </p>
                    <div className="space-y-3">
                      <label className="flex items-center gap-3 cursor-pointer">
                        <input
                          type="checkbox"
                          checked={heatLockEnabled}
                          onChange={(e) => { setActiveTemplate(null); setHeatLockEnabled(e.target.checked); }}
                          className="w-5 h-5 rounded accent-amber-500"
                        />
                        <div>
                          <span className={`font-medium ${darkMode ? 'text-slate-200' : 'text-slate-700'}`}>Heat Lock (Prelims/Finals)</span>
                          <p className={`text-xs ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>
                            Consolation swimmers locked to places 9-16; finals compete for 1-8
                          </p>
                        </div>
                      </label>
                      <label className="flex items-center gap-3 cursor-pointer">
                        <input
                          type="checkbox"
                          checked={aRelayOnly}
                          onChange={(e) => { setActiveTemplate(null); setARelayOnly(e.target.checked); }}
                          className="w-5 h-5 rounded accent-amber-500"
                        />
                        <div>
                          <span className={`font-medium ${darkMode ? 'text-slate-200' : 'text-slate-700'}`}>A-Relay Only Scoring</span>
                          <p className={`text-xs ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>
                            Only A-relays score; B-relays are exhibition (non-scoring)
                          </p>
                        </div>
                      </label>
                    </div>
                    {(heatLockEnabled || aRelayOnly) && (
                      <div className={`mt-3 p-3 rounded-lg text-sm ${darkMode ? 'bg-amber-900/30 border border-amber-700/50 text-amber-200' : 'bg-amber-50 border border-amber-200 text-amber-800'}`}>
                        <strong>Active:</strong> {heatLockEnabled && 'Heat Lock'}{heatLockEnabled && aRelayOnly && ', '}{aRelayOnly && 'A-Relay Only'}
                      </div>
                    )}
                  </div>

                  <div className="mb-6">
                    <h4 className={`font-semibold mb-2 ${darkMode ? 'text-white' : 'text-slate-800'}`}>Data Management</h4>
                    <p className={`text-sm mb-3 ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>
                      Your data will persist when you refresh the page until you clear it.
                    </p>
                    <div className="flex flex-col sm:flex-row gap-3">
                      <button
                        onClick={clearAllDataKeepTemplates}
                        className={`px-4 py-2.5 rounded-xl font-medium transition ${darkMode ? 'bg-orange-500/20 text-orange-400 border border-orange-500/30 hover:bg-orange-500/30' : 'bg-orange-500 hover:bg-orange-600 text-white'}`}
                      >
                        Clear Data (Keep Templates)
                      </button>
                      <button
                        onClick={clearAllDataAndTemplates}
                        className={`px-4 py-2.5 rounded-xl font-medium transition ${darkMode ? 'bg-red-500/20 text-red-400 border border-red-500/30 hover:bg-red-500/30' : 'bg-red-500 hover:bg-red-600 text-white'}`}
                      >
                        Clear All Data & Templates
                      </button>
                    </div>
                  </div>

                  <div className="mb-6">
                    <h4 className={`font-semibold mb-3 ${darkMode ? 'text-white' : 'text-gray-800'}`}>Scoring Templates</h4>
                    
                    <div className="flex flex-wrap gap-3 mb-4">
                      <button
                        onClick={loadHighSchoolMeet}
                        className={`px-4 py-2 rounded-lg ${darkMode ? 'bg-pink-600 hover:bg-pink-700 active:ring-4 active:ring-pink-400 active:scale-95' : 'bg-pink-500 hover:bg-pink-600 active:ring-4 active:ring-pink-300 active:scale-95'} text-white font-medium transition-all shadow-lg hover:shadow-xl ${activeTemplate === 'high_school' ? 'ring-4 ring-white ring-offset-2 ring-offset-transparent' : ''}`}
                      >
                        High School Dual Meet
                      </button>
                      <button
                        onClick={loadChampionshipMeet8}
                        className={`px-4 py-2 rounded-lg ${darkMode ? 'bg-purple-600 hover:bg-purple-700 active:ring-4 active:ring-purple-400 active:scale-95' : 'bg-purple-500 hover:bg-purple-600 active:ring-4 active:ring-purple-300 active:scale-95'} text-white font-medium transition-all shadow-lg hover:shadow-xl ${activeTemplate === 'championship_8' ? 'ring-4 ring-white ring-offset-2 ring-offset-transparent' : ''}`}
                      >
                        Championship Meet (Top 8)
                      </button>
                      <button
                        onClick={loadChampionshipMeet}
                        className={`px-4 py-2 rounded-lg ${darkMode ? 'bg-blue-600 hover:bg-blue-700 active:ring-4 active:ring-blue-400 active:scale-95' : 'bg-blue-500 hover:bg-blue-600 active:ring-4 active:ring-blue-300 active:scale-95'} text-white font-medium transition-all shadow-lg hover:shadow-xl ${activeTemplate === 'championship_16' ? 'ring-4 ring-white ring-offset-2 ring-offset-transparent' : ''}`}
                      >
                        Championship Meet (Top 16)
                      </button>
                      <button
                        onClick={loadNLCMeet}
                        className={`px-4 py-2 rounded-lg ${darkMode ? 'bg-amber-600 hover:bg-amber-700 active:ring-4 active:ring-amber-400 active:scale-95' : 'bg-amber-500 hover:bg-amber-600 active:ring-4 active:ring-amber-300 active:scale-95'} text-white font-medium transition-all shadow-lg hover:shadow-xl ${activeTemplate === 'nlc' ? 'ring-4 ring-white ring-offset-2 ring-offset-transparent' : ''}`}
                      >
                        NLC Meet
                      </button>
                      <button
                        onClick={loadSectionalsMeet}
                        className={`px-4 py-2 rounded-lg ${darkMode ? 'bg-teal-600 hover:bg-teal-700 active:ring-4 active:ring-teal-400 active:scale-95' : 'bg-teal-500 hover:bg-teal-600 active:ring-4 active:ring-teal-300 active:scale-95'} text-white font-medium transition-all shadow-lg hover:shadow-xl ${activeTemplate === 'sectionals' ? 'ring-4 ring-white ring-offset-2 ring-offset-transparent' : ''}`}
                      >
                        Sectionals
                      </button>
                    </div>

                    {savedTemplates.length > 0 && (
                      <div className="mb-4">
                        <p className={`text-sm font-medium mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>Your Custom Templates:</p>
                        <div className="flex flex-wrap gap-2">
                          {savedTemplates.map(template => (
                            <div key={template.id} className={`flex items-center gap-2 px-3 py-2 rounded-lg ${darkMode ? 'bg-gray-600' : 'bg-white border border-gray-300'} ${activeTemplate === 'custom_' + template.id ? 'ring-4 ring-white ring-offset-2 ring-offset-transparent' : ''}`}>
                              <button
                                onClick={() => loadTemplate(template)}
                                className={`font-medium ${darkMode ? 'text-cyan-400 hover:text-cyan-300' : 'text-blue-600 hover:text-blue-700'}`}
                              >
                                {template.name}
                              </button>
                              <button
                                onClick={() => deleteTemplate(template.id)}
                                className="text-red-500 hover:text-red-700"
                              >
                                <X className="w-4 h-4" />
                              </button>
                            </div>
                          ))}
                        </div>
                      </div>
                    )}

                    {showSaveTemplate ? (
                      <div className="flex flex-col sm:flex-row gap-2">
                        <input
                          type="text"
                          value={newTemplateName}
                          onChange={(e) => setNewTemplateName(e.target.value)}
                          onKeyDown={(e) => e.key === 'Enter' && saveTemplate()}
                          placeholder="Template name"
                          autoFocus
                          className={`flex-1 px-3 py-2 border rounded-lg ${darkMode ? 'bg-gray-600 border-gray-500 text-white placeholder-gray-400' : 'bg-white border-gray-300'}`}
                        />
                        <button
                          onClick={saveTemplate}
                          className={`px-4 py-2 rounded-lg ${darkMode ? 'bg-green-600 hover:bg-green-700' : 'bg-green-500 hover:bg-green-600'} text-white font-medium`}
                        >
                          Save
                        </button>
                        <button
                          onClick={() => {
                            setShowSaveTemplate(false);
                            setNewTemplateName('');
                          }}
                          className={`px-4 py-2 rounded-lg ${darkMode ? 'bg-gray-600 hover:bg-gray-500' : 'bg-gray-300 hover:bg-gray-400'} text-gray-800 font-medium`}
                        >
                          Cancel
                        </button>
                      </div>
                    ) : (
                      <button
                        onClick={() => setShowSaveTemplate(true)}
                        className={`px-4 py-2 rounded-lg ${darkMode ? 'bg-gray-600 hover:bg-gray-500 text-white' : 'bg-gray-200 hover:bg-gray-300 text-gray-800'} font-medium`}
                      >
                        + Save Current Settings as Template
                      </button>
                    )}

                    <p className={`text-xs mt-2 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                      Templates save all point systems, number of places, and event lineup
                    </p>
                  </div>

                  <div className="mb-6">
                    <h4 className={`font-semibold mb-3 ${darkMode ? 'text-white' : 'text-gray-800'}`}>Number of Scoring Places</h4>
                    
                    <div className="mb-4">
                      <label className={`text-sm mb-2 block ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>Diving Events</label>
                      <div className="flex items-center gap-3 flex-wrap">
                        <NumberInput
                          value={numDivingPlaces}
                          onChange={handleManualSettingChange(setNumDivingPlaces)}
                          min={1}
                          max={20}
                          darkMode={darkMode}
                          label="diving places"
                        />
                        <span className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>(1-20)</span>
                      </div>
                    </div>

                    <div className="mb-4">
                      <label className={`text-sm mb-2 block ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>Individual Events</label>
                      <div className="flex items-center gap-3 flex-wrap">
                        <NumberInput
                          value={numIndividualPlaces}
                          onChange={handleManualSettingChange(setNumIndividualPlaces)}
                          min={1}
                          max={20}
                          darkMode={darkMode}
                          label="individual places"
                        />
                        <span className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>(1-20)</span>
                      </div>
                    </div>

                    <div>
                      <label className={`text-sm mb-2 block ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>Relay Events</label>
                      <div className="flex items-center gap-3 flex-wrap">
                        <NumberInput
                          value={numRelayPlaces}
                          onChange={handleManualSettingChange(setNumRelayPlaces)}
                          min={1}
                          max={20}
                          darkMode={darkMode}
                          label="relay places"
                        />
                        <span className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>(1-20)</span>
                      </div>
                    </div>
                  </div>
                  
                  <div className="mb-6">
                    <h4 className={`font-semibold mb-2 ${darkMode ? 'text-white' : 'text-gray-800'}`}>Manage Teams</h4>
                    <div className="flex flex-col sm:flex-row gap-2 mb-3">
                      <input
                        type="text"
                        value={newTeamName}
                        onChange={(e) => setNewTeamName(e.target.value)}
                        onKeyDown={(e) => e.key === 'Enter' && addTeam()}
                        placeholder="Team name"
                        className={`flex-1 px-3 py-2 border rounded-lg ${darkMode ? 'bg-gray-600 border-gray-500 text-white placeholder-gray-400' : 'bg-white border-gray-300'}`}
                      />
                      <button
                        onClick={addTeam}
                        className={`px-4 py-2 rounded-lg flex items-center gap-2 ${darkMode ? 'bg-cyan-600 hover:bg-cyan-700' : 'bg-blue-600 hover:bg-blue-700'} text-white`}
                      >
                        <Plus className="w-4 h-4" /> Add Team
                      </button>
                    </div>
                    <div className="flex flex-wrap gap-2">
                      {teams.map(team => (
                        <div key={team.id} className={`flex items-center gap-2 px-3 py-2 rounded-lg ${darkMode ? 'bg-gray-600 text-white' : 'bg-white'}`}>
                          <span>{team.name}</span>
                          <button
                            onClick={() => removeTeam(team.id)}
                            className="text-red-500 hover:text-red-700"
                          >
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ))}
                    </div>
                  </div>

                  <div className="mb-6">
                    <h4 className={`font-semibold mb-2 ${darkMode ? 'text-white' : 'text-gray-800'}`}>Diving Point System</h4>
                    <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-2 sm:gap-3 mb-6">
                      {getPlacesArray({ name: 'Diving' }).map(place => (
                        <PointInput
                          key={place}
                          place={place}
                          value={divingPointSystem[place] ?? 0}
                          onChange={(value) => {
                            setActiveTemplate(null);
                            const newPoints = { ...divingPointSystem, [place]: value };
                            setDivingPointSystem(newPoints);
                          }}
                          onBlur={() => recalculateAllScores(teams, events)}
                          darkMode={darkMode}
                        />
                      ))}
                    </div>

                    <h4 className={`font-semibold mb-2 ${darkMode ? 'text-white' : 'text-gray-800'}`}>Individual Events Point System</h4>
                    <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-2 sm:gap-3 mb-6">
                      {getPlacesArray({ name: 'Swimming' }).map(place => (
                        <PointInput
                          key={place}
                          place={place}
                          value={individualPointSystem[place] ?? 0}
                          onChange={(value) => {
                            setActiveTemplate(null);
                            const newPoints = { ...individualPointSystem, [place]: value };
                            setIndividualPointSystem(newPoints);
                          }}
                          onBlur={() => recalculateAllScores(teams, events)}
                          darkMode={darkMode}
                        />
                      ))}
                    </div>

                    <h4 className={`font-semibold mb-2 ${darkMode ? 'text-white' : 'text-gray-800'}`}>Relay Events Point System</h4>
                    <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-2 sm:gap-3">
                      {getPlacesArray({ name: 'Relay' }).map(place => (
                        <PointInput
                          key={place}
                          place={place}
                          value={relayPointSystem[place] ?? 0}
                          onChange={(value) => {
                            setActiveTemplate(null);
                            const newPoints = { ...relayPointSystem, [place]: value };
                            setRelayPointSystem(newPoints);
                          }}
                          onBlur={() => recalculateAllScores(teams, events)}
                          darkMode={darkMode}
                        />
                      ))}
                    </div>
                  </div>
                  </div>

                  {/* Settings Footer */}
                  <div className={`px-4 sm:px-6 py-4 border-t ${darkMode ? 'bg-gray-800 border-gray-700' : 'bg-gray-50 border-gray-200'}`}>
                    <button
                      onClick={() => setShowSettings(false)}
                      className={`w-full py-3 rounded-lg font-semibold text-white transition ${darkMode ? 'bg-cyan-600 hover:bg-cyan-700' : 'bg-blue-600 hover:bg-blue-700'}`}
                    >
                      Close Settings
                    </button>
                  </div>
                </div>
              )}

              <div className={`rounded-2xl p-6 mb-6 relative overflow-hidden ${darkMode ? 'bg-gradient-to-br from-pool-mid to-pool-light border border-chlorine/20' : 'bg-gradient-to-br from-cyan-500 to-blue-600'}`}>
                {/* Lane lines decoration */}
                <div className="absolute inset-0 opacity-10" style={{
                  backgroundImage: 'repeating-linear-gradient(90deg, transparent 0px, transparent 40px, rgba(255,255,255,0.3) 40px, rgba(255,255,255,0.3) 42px)'
                }} />
                
                <div className="relative flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 gap-3">
                  <div className="flex items-center gap-3">
                    <h2 className={`text-2xl font-bold ${darkMode ? 'text-chlorine' : 'text-white'}`}>Scoreboard</h2>
                    <button
                      onClick={shareScores}
                      className={`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition ${darkMode ? 'bg-chlorine/20 text-chlorine hover:bg-chlorine/30 border border-chlorine/30' : 'bg-white/20 text-white hover:bg-white/30'}`}
                      title="Share scores"
                    >
                      <Share className="w-4 h-4" />
                      Share
                    </button>
                  </div>
                  <div className="flex gap-1.5">
                    <button
                      onClick={() => { setScoringMode('combined'); trackEvent('change_scoring_mode', { mode: 'combined' }); }}
                      className={`px-3 py-1.5 rounded-lg text-xs font-semibold transition ${
                        scoringMode === 'combined'
                          ? (darkMode ? 'bg-chlorine text-pool-deep' : 'bg-white text-cyan-600')
                          : 'bg-white/20 text-white hover:bg-white/30'
                      }`}
                    >
                      Combined
                    </button>
                    <button
                      onClick={() => { setScoringMode('girls'); trackEvent('change_scoring_mode', { mode: 'girls' }); }}
                      className={`px-3 py-1.5 rounded-lg text-xs font-semibold transition ${
                        scoringMode === 'girls'
                          ? 'bg-pink-500 text-white'
                          : 'bg-pink-400/30 text-white hover:bg-pink-400/50'
                      }`}
                    >
                      Girls Only
                    </button>
                    <button
                      onClick={() => { setScoringMode('boys'); trackEvent('change_scoring_mode', { mode: 'boys' }); }}
                      className={`px-3 py-1.5 rounded-lg text-xs font-semibold transition ${
                        scoringMode === 'boys'
                          ? 'bg-blue-500 text-white'
                          : 'bg-blue-400/30 text-white hover:bg-blue-400/50'
                      }`}
                    >
                      Boys Only
                    </button>
                  </div>
                </div>
                <div className="relative grid gap-2">
                  {sortedTeams.length === 0 ? (
                    <div className={`rounded-xl p-4 text-center ${darkMode ? 'bg-pool-deep/50 text-slate-400 border border-white/10' : 'bg-white/90 text-slate-500'}`}>
                      No teams added yet. Add teams in Settings.
                    </div>
                  ) : (
                    sortedTeams.map((team, index) => (
                    <div key={team.id} className={`rounded-xl p-2 sm:p-3 transition-all ${
                      index === 0 
                        ? (darkMode ? 'bg-gradient-to-r from-lane-gold/20 to-transparent border-l-4 border-lane-gold' : 'bg-gradient-to-r from-amber-50 to-white border-l-4 border-amber-400')
                        : (darkMode ? 'bg-pool-deep/50 border border-white/5' : 'bg-white/90')
                    }`}>
                      <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-1 sm:gap-2">
                        <div className="flex items-center gap-2 sm:gap-4">
                          <span className={`text-lg sm:text-2xl font-bold ${
                            index === 0 
                              ? (darkMode ? 'text-lane-gold' : 'text-amber-500')
                              : (darkMode ? 'text-slate-500' : 'text-slate-400')
                          }`}>#{index + 1}</span>
                          {editingTeamId === team.id ? (
                            <input
                              type="text"
                              value={editingTeamName}
                              onChange={(e) => setEditingTeamName(e.target.value)}
                              onBlur={() => saveTeamName(team.id)}
                              onKeyDown={(e) => {
                                if (e.key === 'Enter') saveTeamName(team.id);
                                if (e.key === 'Escape') cancelEditingTeam();
                              }}
                              autoFocus
                              className={`text-lg sm:text-xl font-semibold px-2 py-1 border rounded ${darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-white border-gray-300'}`}
                            />
                          ) : (
                            <span 
                              onClick={() => startEditingTeam(team)}
                              className={`text-base sm:text-xl font-semibold cursor-pointer hover:underline ${darkMode ? 'text-white' : 'text-gray-800'}`}
                            >
                              {team.name}
                            </span>
                          )}
                        </div>
                        <div className="flex items-center justify-between sm:justify-end gap-4 sm:gap-6 ml-8 sm:ml-0">
                          {scoringMode === 'combined' && (
                            <div className="flex gap-4 text-sm">
                              <div className="text-center">
                                <div className={`font-medium ${darkMode ? 'text-pink-400' : 'text-pink-600'}`}>Girls</div>
                                <div className={`text-lg font-bold ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>{team.girlsScore}</div>
                              </div>
                              <div className="text-center">
                                <div className={`font-medium ${darkMode ? 'text-blue-400' : 'text-blue-600'}`}>Boys</div>
                                <div className={`text-lg font-bold ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>{team.boysScore}</div>
                              </div>
                            </div>
                          )}
                          <span className={`text-xl sm:text-3xl font-bold ${darkMode ? 'text-cyan-400' : 'text-blue-600'}`}>
                            {scoringMode === 'girls' ? team.girlsScore : scoringMode === 'boys' ? team.boysScore : team.score}
                          </span>
                        </div>
                      </div>
                    </div>
                    ))
                  )}
                </div>
              </div>

              <div>
                <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 gap-2">
                  <div className="flex items-center gap-2 flex-wrap">
                    <h3 className={`text-xl font-bold ${darkMode ? 'text-chlorine' : 'text-slate-800'}`}>Events</h3>
                    {/* Entry Mode Toggle */}
                    <button
                      onClick={() => { setQuickEntryMode(!quickEntryMode); triggerHaptic('light'); trackEvent('toggle_entry_mode', { mode: !quickEntryMode ? 'team-first' : 'place-first' }); }}
                      className={`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition ${
                        quickEntryMode
                          ? (darkMode ? 'bg-lane-gold text-pool-deep' : 'bg-amber-500 text-white')
                          : (darkMode ? 'bg-gray-700 text-gray-300 hover:bg-gray-600 border border-gray-600' : 'bg-gray-100 text-gray-600 hover:bg-gray-200 border border-gray-300')
                      }`}
                      title={quickEntryMode ? "Switch to Place-First mode" : "Switch to Team-First Quick Entry mode"}
                    >
                      <Zap className="w-3.5 h-3.5" />
                      {quickEntryMode ? 'Quick Mode ON' : 'Quick Mode'}
                    </button>
                    <button
                      onClick={emailResults}
                      className={`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition ${darkMode ? 'bg-chlorine/20 text-chlorine hover:bg-chlorine/30 border border-chlorine/30' : 'bg-cyan-600 text-white hover:bg-cyan-700'}`}
                      title="Email full results"
                    >
                      <Mail className="w-4 h-4" />
                      Email Results
                    </button>
                  </div>
                  <div className={`text-xs px-3 py-1.5 rounded-full ${darkMode ? 'bg-lane-gold/20 text-lane-gold border border-lane-gold/30' : 'bg-amber-100 text-amber-700 border border-amber-200'}`}>
                    {quickEntryMode 
                      ? '‚ö° Tap place numbers to assign to each team'
                      : 'üí° Tip: Select multiple teams in a place for ties'
                    }
                  </div>
                </div>
                {scoringMode === 'combined' ? (
                  <div className={`space-y-${quickEntryMode ? '2' : '4'}`}>
                    {events.map((event, index) => {
                      const isDiving = event.name === 'Diving';
                      const isRelay = event.name.includes('Relay');
                      const pointSystem = isDiving ? divingPointSystem : isRelay ? relayPointSystem : individualPointSystem;
                      const numPlaces = isDiving ? numDivingPlaces : isRelay ? numRelayPlaces : numIndividualPlaces;
                      
                      // Quick Entry Mode - Team-first compact cards
                      if (quickEntryMode) {
                        return (
                          <QuickEntryEventCard
                            key={event.id}
                            event={event}
                            teams={teams}
                            darkMode={darkMode}
                            numPlaces={numPlaces}
                            pointSystem={pointSystem}
                            onUpdate={updateEventResult}
                            onMoveUp={() => moveEventUp(index)}
                            onMoveDown={() => moveEventDown(index)}
                            onRemove={() => removeEvent(event.id)}
                            canMoveUp={index > 0}
                            canMoveDown={index < events.length - 1}
                            heatLockEnabled={heatLockEnabled}
                            aRelayOnly={aRelayOnly}
                            onToggleDQ={toggleDisqualification}
                          />
                        );
                      }
                      
                      // Default Mode - Place-first with dropdowns
                      return (
                        <div key={event.id} className={`rounded-xl p-4 ${darkMode ? 'bg-pool-mid/80 border border-white/10' : 'bg-white border border-slate-200 shadow-sm'}`}>
                          <div className="flex items-center justify-between mb-3">
                            <div className="flex items-center gap-2 flex-wrap">
                              <h5 className={`font-semibold text-lg ${darkMode ? 'text-white' : 'text-slate-800'}`}>
                                <span className={event.gender === 'girls' ? (darkMode ? 'text-pink-400' : 'text-pink-600') : (darkMode ? 'text-blue-400' : 'text-blue-600')}>
                                  {event.gender === 'girls' ? 'Girls' : 'Boys'}
                                </span>
                                {' '}
                                <span className={isDiving ? (darkMode ? 'text-orange-400' : 'text-orange-600') : ''}>
                                  {event.name}
                                </span>
                              </h5>
                              {/* Visual indicators for NLC/Sectionals settings */}
                              {heatLockEnabled && !isRelay && (
                                <span className={`text-xs px-2 py-0.5 rounded-full ${darkMode ? 'bg-amber-500/20 text-amber-400 border border-amber-500/30' : 'bg-amber-100 text-amber-700 border border-amber-200'}`}>
                                  üîí 1-8 Finals / 9-16 Consolation
                                </span>
                              )}
                              {aRelayOnly && isRelay && (
                                <span className={`text-xs px-2 py-0.5 rounded-full ${darkMode ? 'bg-teal-500/20 text-teal-400 border border-teal-500/30' : 'bg-teal-100 text-teal-700 border border-teal-200'}`}>
                                  üÖ∞Ô∏è A-Relay Only Scores
                                </span>
                              )}
                            </div>
                            <div className="flex items-center gap-2">
                              <button
                                onClick={() => moveEventUp(index)}
                                disabled={index === 0}
                                className={`p-1 rounded ${index === 0 ? 'opacity-30 cursor-not-allowed' : (darkMode ? 'hover:bg-white/10' : 'hover:bg-slate-100')} ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}
                              >
                                <ChevronUp className="w-5 h-5" />
                              </button>
                              <button
                                onClick={() => moveEventDown(index)}
                                disabled={index === events.length - 1}
                                className={`p-1 rounded ${index === events.length - 1 ? 'opacity-30 cursor-not-allowed' : (darkMode ? 'hover:bg-white/10' : 'hover:bg-slate-100')} ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}
                              >
                                <ChevronDown className="w-5 h-5" />
                              </button>
                              <button
                                onClick={() => removeEvent(event.id)}
                                className={`p-1 rounded ${darkMode ? 'text-red-400 hover:bg-red-500/20' : 'text-red-500 hover:bg-red-50'}`}
                              >
                                <X className="w-5 h-5" />
                              </button>
                            </div>
                          </div>
                          <div className="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-1">
                            {(() => {
                              const consumedPlaces = getConsumedPlaces(event);
                              return getPlacesArray(event).map(place => (
                                <PlaceSelector
                                  key={place}
                                  event={event}
                                  place={place}
                                  teams={teams}
                                  darkMode={darkMode}
                                  pointSystem={pointSystem}
                                  numPlaces={numPlaces}
                                  onUpdate={updateEventResult}
                                  consumedByTie={consumedPlaces.has(place)}
                                  onToggleDQ={toggleDisqualification}
                                />
                              ));
                            })()}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                ) : (
                  <div>
                    <h4 className={`text-lg font-semibold mb-4 ${scoringMode === 'girls' ? (darkMode ? 'text-pink-400' : 'text-pink-600') : (darkMode ? 'text-blue-400' : 'text-blue-600')}`}>
                      {scoringMode === 'girls' ? 'Girls Events' : 'Boys Events'}
                    </h4>
                    <div className={`space-y-${quickEntryMode ? '2' : '4'}`}>
                      {events.filter(e => e.gender === scoringMode).map((event, index) => {
                        const isDiving = event.name === 'Diving';
                        const isRelay = event.name.includes('Relay');
                        const allEvents = events.filter(e => e.gender === scoringMode);
                        const actualIndex = events.findIndex(e => e.id === event.id);
                        const pointSystem = isDiving ? divingPointSystem : isRelay ? relayPointSystem : individualPointSystem;
                        const numPlaces = isDiving ? numDivingPlaces : isRelay ? numRelayPlaces : numIndividualPlaces;
                        
                        // Quick Entry Mode - Team-first compact cards
                        if (quickEntryMode) {
                          return (
                            <QuickEntryEventCard
                              key={event.id}
                              event={event}
                              teams={teams}
                              darkMode={darkMode}
                              numPlaces={numPlaces}
                              pointSystem={pointSystem}
                              onUpdate={updateEventResult}
                              onMoveUp={() => moveEventUp(actualIndex)}
                              onMoveDown={() => moveEventDown(actualIndex)}
                              onRemove={() => removeEvent(event.id)}
                              canMoveUp={actualIndex > 0}
                              canMoveDown={actualIndex < events.length - 1}
                              heatLockEnabled={heatLockEnabled}
                              aRelayOnly={aRelayOnly}
                              onToggleDQ={toggleDisqualification}
                            />
                          );
                        }
                        
                        // Default Mode - Place-first with dropdowns
                        return (
                          <div key={event.id} className={`rounded-xl p-4 ${darkMode ? 'bg-pool-mid/80 border border-white/10' : 'bg-white border border-slate-200 shadow-sm'}`}>
                            <div className="flex items-center justify-between mb-3">
                              <div className="flex items-center gap-2 flex-wrap">
                                <h5 className={`font-semibold text-lg ${isDiving ? (darkMode ? 'text-orange-400' : 'text-orange-600') : (darkMode ? 'text-white' : 'text-slate-800')}`}>{event.name}</h5>
                                {/* Visual indicators for NLC/Sectionals settings */}
                                {heatLockEnabled && !isRelay && (
                                  <span className={`text-xs px-2 py-0.5 rounded-full ${darkMode ? 'bg-amber-500/20 text-amber-400 border border-amber-500/30' : 'bg-amber-100 text-amber-700 border border-amber-200'}`}>
                                    üîí 1-8 Finals / 9-16 Consolation
                                  </span>
                                )}
                                {aRelayOnly && isRelay && (
                                  <span className={`text-xs px-2 py-0.5 rounded-full ${darkMode ? 'bg-teal-500/20 text-teal-400 border border-teal-500/30' : 'bg-teal-100 text-teal-700 border border-teal-200'}`}>
                                    üÖ∞Ô∏è A-Relay Only Scores
                                  </span>
                                )}
                              </div>
                              <div className="flex items-center gap-2">
                                <button
                                  onClick={() => moveEventUp(actualIndex)}
                                  disabled={actualIndex === 0}
                                  className={`p-1 rounded ${actualIndex === 0 ? 'opacity-30 cursor-not-allowed' : (darkMode ? 'hover:bg-white/10' : 'hover:bg-slate-100')} ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}
                                >
                                  <ChevronUp className="w-5 h-5" />
                                </button>
                                <button
                                  onClick={() => moveEventDown(actualIndex)}
                                  disabled={actualIndex === events.length - 1}
                                  className={`p-1 rounded ${actualIndex === events.length - 1 ? 'opacity-30 cursor-not-allowed' : (darkMode ? 'hover:bg-white/10' : 'hover:bg-slate-100')} ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}
                                >
                                  <ChevronDown className="w-5 h-5" />
                                </button>
                                <button
                                  onClick={() => removeEvent(event.id)}
                                  className={`p-1 rounded ${darkMode ? 'text-red-400 hover:bg-red-500/20' : 'text-red-500 hover:bg-red-50'}`}
                                >
                                  <X className="w-5 h-5" />
                                </button>
                              </div>
                            </div>
                            <div className="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-1">
                              {(() => {
                                const consumedPlaces = getConsumedPlaces(event);
                                return getPlacesArray(event).map(place => (
                                  <PlaceSelector
                                    key={place}
                                    event={event}
                                    place={place}
                                    teams={teams}
                                    darkMode={darkMode}
                                    pointSystem={pointSystem}
                                    numPlaces={numPlaces}
                                    onUpdate={updateEventResult}
                                    consumedByTie={consumedPlaces.has(place)}
                                    onToggleDQ={toggleDisqualification}
                                  />
                                ));
                              })()}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                )}

                <div className={`rounded-lg p-4 mt-6 ${darkMode ? 'bg-gray-700' : 'bg-gray-100'}`}>
                  <h4 className={`font-semibold mb-3 ${darkMode ? 'text-white' : 'text-gray-800'}`}>Add New Event</h4>
                  <div className="flex flex-col sm:flex-row gap-2 mb-2">
                    <input
                      type="text"
                      value={newEventName}
                      onChange={(e) => setNewEventName(e.target.value)}
                      onKeyDown={(e) => e.key === 'Enter' && addEvent()}
                      placeholder={newEventType === 'diving' ? 'Diving (name auto-filled)' : newEventType === 'relay' ? 'e.g., 200 Medley' : 'e.g., 100 Backstroke'}
                      disabled={newEventType === 'diving'}
                      className={`flex-1 px-3 py-2 border rounded-lg ${darkMode ? 'bg-gray-600 border-gray-500 text-white placeholder-gray-400' : 'bg-white border-gray-300'} ${newEventType === 'diving' ? 'opacity-50' : ''}`}
                    />
                    <div className="flex gap-2 flex-wrap">
                      <select
                        value={newEventType}
                        onChange={(e) => {
                          setNewEventType(e.target.value);
                          if (e.target.value === 'diving') setNewEventName('Diving');
                          else if (newEventName === 'Diving') setNewEventName('');
                        }}
                        className={`flex-1 sm:flex-none px-3 py-2 border rounded-lg ${darkMode ? 'bg-gray-600 border-gray-500 text-white' : 'bg-white border-gray-300'}`}
                      >
                        <option value="individual">Individual</option>
                        <option value="relay">Relay</option>
                        <option value="diving">Diving</option>
                      </select>
                      <select
                        value={newEventGender}
                        onChange={(e) => setNewEventGender(e.target.value)}
                        className={`flex-1 sm:flex-none px-3 py-2 border rounded-lg ${darkMode ? 'bg-gray-600 border-gray-500 text-white' : 'bg-white border-gray-300'}`}
                      >
                        <option value="girls">Girls</option>
                        <option value="boys">Boys</option>
                      </select>
                      <button
                        onClick={addEvent}
                        className={`flex-1 sm:flex-none px-4 py-2 rounded-lg flex items-center justify-center gap-2 text-white ${darkMode ? 'bg-cyan-600 hover:bg-cyan-700' : 'bg-blue-600 hover:bg-blue-700'}`}
                      >
                        <Plus className="w-4 h-4" /> Add
                      </button>
                    </div>
                  </div>
                  <p className={`text-xs ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                    {newEventType === 'diving' && 'Diving events use their own point system'}
                    {newEventType === 'relay' && '"Relay" will be automatically added to the event name'}
                    {newEventType === 'individual' && 'Individual swimming events'}
                  </p>
                </div>
              </div>
            </div>
          </div>

          {/* Footer */}
          <footer className={`mt-8 py-6 border-t ${darkMode ? 'border-gray-700' : 'border-gray-200'}`}>
            <div className="max-w-4xl mx-auto px-4">
              {/* Contact Section */}
              <div className="mb-6">
                <h4 className={`font-semibold mb-2 ${darkMode ? 'text-white' : 'text-gray-800'}`}>Contact Us</h4>
                <div className={`space-y-1 text-sm ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>
                  <div>
                    <span className={darkMode ? 'text-gray-400' : 'text-gray-500'}>General Inquiries: </span>
                    <a href="mailto:info@swimmeetscore.com" className="text-cyan-600 hover:text-cyan-700 hover:underline">
                      info@swimmeetscore.com
                    </a>
                  </div>
                  <div>
                    <span className={darkMode ? 'text-gray-400' : 'text-gray-500'}>Support: </span>
                    <a href="mailto:support@swimmeetscore.com" className="text-cyan-600 hover:text-cyan-700 hover:underline">
                      support@swimmeetscore.com
                    </a>
                  </div>
                </div>
              </div>

              {/* Donate Button */}
              <div className={`mt-6 p-6 rounded-xl text-center ${darkMode ? 'bg-gradient-to-r from-yellow-500/20 to-orange-500/20 border border-yellow-500/30' : 'bg-gradient-to-r from-yellow-50 to-orange-50 border border-yellow-200'}`}>
                <p className={`text-lg font-medium mb-2 ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                  ‚òï Enjoying Swim Meet Score?
                </p>
                <p className={`text-sm mb-4 ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>
                  SwimMeetScore is free and ad-free. If it saved you time today, consider a coffee!
                </p>
                <a 
                  href="https://buymeacoffee.com/kadenco" 
                  target="_blank" 
                  rel="noopener noreferrer"
                  onClick={() => trackEvent('click_donate')}
                  className="inline-flex items-center gap-3 px-8 py-4 bg-yellow-400 hover:bg-yellow-500 text-gray-900 font-bold text-lg rounded-xl transition shadow-lg hover:shadow-xl hover:scale-105 transform"
                >
                  <svg className="w-7 h-7" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M4 19h16v2H4v-2zm16-12h-2V5H6v2H4V5c0-1.1.9-2 2-2h12c1.1 0 2 .9 2 2v2zm-2 2H6c-1.1 0-2 .9-2 2v5c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-1h1c1.1 0 2-.9 2-2v-2c0-1.1-.9-2-2-2h-1zm1 4h-1v-2h1v2zm-3 3H6v-5h12v5z"/>
                  </svg>
                  Buy Me a Coffee
                </a>
              </div>

              {/* Copyright */}
              <div className={`mt-6 pt-4 border-t text-center text-sm ${darkMode ? 'border-gray-700 text-gray-400' : 'border-gray-200 text-gray-500'}`}>
                Copyright ¬© 2026 Kaden Co - All rights reserved.
              </div>

              {/* Legal Disclaimer */}
              <div className={`mt-4 text-xs ${darkMode ? 'text-gray-500' : 'text-gray-400'} text-center max-w-2xl mx-auto`}>
                <p className="mb-2">
                  <strong>Terms of Use:</strong> This application is provided "as is" without warranties. Users are responsible for the accuracy of data entered. 
                  Swim Meet Score is not liable for any scoring errors or data loss.
                </p>
                <p>
                  <strong>Privacy & Data:</strong> Your meet data is stored locally in your browser using localStorage and is never transmitted to our servers. 
                  We use Google Analytics to collect anonymous usage statistics (pages visited, features used) to improve the app. 
                  No personal information is required to use this application. By using SwimMeetScore, you consent to this data collection.
                </p>
              </div>
            </div>
          </footer>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<SwimMeetScore />);
    
    // Hide loading screen after render
    hideLoadingScreen();
  </script>

  <!-- Service Worker Registration for Offline Support -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then((registration) => {
            console.log('SwimMeetScore: Service Worker registered successfully');
            
            // Check for updates periodically
            setInterval(() => {
              registration.update();
            }, 60 * 60 * 1000); // Check every hour
          })
          .catch((error) => {
            console.log('SwimMeetScore: Service Worker registration failed:', error);
          });
      });
    }
  </script>
</body>
</html>
